<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-02-07 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180207" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Alternet Tools &#x2013; Properties binder and class generator</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
            <div class="container"><div class="nav-collapse">
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../" title="Home">Home</a></li>
            <li><a href="https://github.com/alternet/alternet.ml" title="GitHub project">GitHub project</a></li>
            <li><a href="http://semantic-mismatch.blogspot.fr/" title="Blog">Blog</a></li>
            <li><a href="../release-notes.html" title="Release notes">Release notes</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../download.html" title="Download">Download</a></li>
            <li><a href="../license.html" title="License">License</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../parsing/index.html" title="Alternet Parsing">Alternet Parsing</a></li>
            <li><a href="../scanner/index.html" title="Alternet Scanner">Alternet Scanner</a></li>
            <li><a href="../security/index.html" title="Alternet Security">Alternet Security</a></li>
            <li><a href="../tools/index.html" title="Alternet Tools">Alternet Tools</a></li>
            <li><a href="../tools-generator/index.html" title="Alternet Tools - Generator">Alternet Tools - Generator</a></li>
            <li><a href="../prop-bind-maven-plugin/index.html" title="Properties Binder Maven Plugin">Properties Binder Maven Plugin</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Maven reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="project-summary.html" title="Summary">Summary</a></li>
                  <li><a href="license.html" title="Licenses">Licenses</a></li>
                  <li><a href="team-list.html" title="Team">Team</a></li>
                  <li><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="issue-tracking.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
                  <li><a href="xref/index.html" title="Source Xref">Source Xref</a></li>
                  <li><a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
                  <li><a href="surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="cpd.html" title="CPD">CPD</a></li>
                  <li><a href="pmd.html" title="PMD">PMD</a></li>
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
              </ul>
                    <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://github.com/alternet/alternet.ml" title="GitHub project">GitHub project</a></li>
    <li><a href="../demo.html" title="Other Demos">Other Demos</a></li>
                </ul>
              </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Alternet Tools</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-02-07<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0<span class="divider">|</span></li>
        <li class=""><a href="../.." title="Alternet">Alternet</a><span class="divider">»</span></li>
      <li class=""><a href="../index.html" title="Alternet Libs">Alternet Libs</a><span class="divider">»</span></li>
      <li class=""><a href="index.html" title="Alternet Tools">Alternet Tools</a><span class="divider">»</span></li>
    <li class="active ">Properties binder and class generator</li>
        </ul>
      </div>
        <div id="bodyColumn" >
<h1>Properties binder and class generator</h1>

<div class="nopub">
<a class="externalLink" href="http://alternet.ml/alternet-libs/tools/properties.html">
Published version of this page available HERE</a></div>
<p>Given a Java property file, allow to populate a counterpart class with typed values.</p>
<p>Also allow to generate the target class(es), and run that generator as a Maven plugin.</p>

<ol style="list-style-type: decimal">
  
<li><a href="#overview">Overview</a></li>
  
<li><a href="#tutorial">Tutorial</a>
  
<ol style="list-style-type: decimal">
    
<li><a href="#binder">Populating fields with property values</a></li>
    
<li><a href="#template">Creating the template property file</a>
    
<ol style="list-style-type: decimal">
      
<li><a href="#directives">Directives</a></li>
      
<li><a href="#primitives">Primitives</a></li>
      
<li><a href="#uris">URIs</a></li>
      
<li><a href="#strings">Strings</a></li>
      
<li><a href="#classes">Classes</a></li>
      
<li><a href="#passwords">Passwords</a></li>
      
<li><a href="#adapters">Other types, adapters, and other directives</a></li>
      
<li><a href="#unmarshaller">Unmarshaller</a></li>
      
<li><a href="#intermediatesTypes">Intermediate types</a></li>
      
<li><a href="#files">Files</a></li>
      
<li><a href="#datesTimes">Dates and times</a></li>
      
<li><a href="#lists">Lists</a></li>
      
<li><a href="#enums">Enums</a></li>
      
<li><a href="#unknownKeys">Unknown keys</a></li>
      
<li><a href="#typesWithValue">Types with value</a></li>
      
<li><a href="#separateTypes">Separate types</a></li>
      
<li><a href="#rules">Rules for types</a></li>
    </ol></li>
    
<li><a href="#generator">Generating the target class</a>
    
<ol style="list-style-type: decimal">
      
<li><a href="#maven">Generating the target class with Maven</a></li>
    </ol></li>
  </ol></li>
  
<li><a href="#otherFeatures">Other features</a>
  
<ol style="list-style-type: decimal">
    
<li><a href="#default">Default values</a></li>
    
<li><a href="#merging">Merging separate property files</a></li>
    
<li><a href="#interpolation">Variable interpolation</a></li>
    
<li><a href="#renaming">Automatic renaming</a></li>
  </ol></li>
</ol>
<p><a name="overview"></a></p>
<div class="section">
<h2><a name="Overview"></a>Overview</h2>

<div style="columns: 2">

<div>

<div class="section" style="margin: 0">
<h3 style="margin: 0"><a name="Maven_import"></a>Maven import</h3>

<div>
<pre class="prettyprint">
&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-tools&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>

<div style="break-before: column">
</div>
<div class="section">
<h3><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h3>

<ul>
<li><a href="apidocs/index.html">Alternet Tools</a></li></ul>

<p>Other Alternet APIs :</p>

<ul>
<li><a href="../apidocs/index.html">Alternet Libs</a></li></ul>
</div>
</div>
<p><a name="tutorial"></a></p></div></div>
<div class="section">
<h2><a name="Tutorial"></a>Tutorial</h2>
<p>Many Java applications are configured with external parameters that have to be loaded by the application from &#x201c;<tt>.properties</tt>&#x201d; files. Once loaded, those parameters are exposed as <tt>String</tt>s, and the keys to access them are also <tt>String</tt>s.</p>

<ul>
  
<li>
<p>The <b>property binder</b> allow to populate a configuration class within which fields are the counterpart keys, and values are typed values.</p></li>
  
<li>
<p>The <b>property generator</b> allow to generate such configuration class from a template property file. A Maven plugin allow to do it automatically.</p></li>
</ul>
<p><a name="binder"></a></p>
<div class="section">
<h3><a name="Populating_fields_with_property_values"></a>Populating fields with property values</h3>
<p>Say we have such a configuration file &#x201c;<tt>conf.properties</tt>&#x201d; :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# Properties definining the GUI
gui.window.width = 500
gui.window.height = 300
gui.colors.background = #FFFFFF
gui.colors.foreground = #000080

# Properties definining datasources
service.url = https://some-services.example.org/someService
service.uuid = 5da66c77-7062-4b30-97fc-e747eb64570a

db.driver = com.fakesql.jdbc.Driver
db.url = jdbc:fakesql://localhost:3306/localdb?autoReconnect=true
db.account.login = theLogin
db.account.password = thePassword
</pre></div></div>
<p>Using the property binder allow to load that file to the target class <tt>org.example.Conf</tt>, and then use the properties as typed data :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    // unmarshall the property file to an org.example.Conf object
    Conf conf = Conf.unmarshall(new FileInputStream(&quot;conf.properties&quot;));

    // look, we have an int :
    int width = Math.min(conf.gui.window.width, 400);
    // we can also use typed data in place :
    Dimension size = new Dimension(width, conf.gui.window.height);

   // look, we have an URI :
    URLConnection extService = conf.service.url.toURL().openConnection();

    // we can also supply an adapter for other types
    // such as java.awt.Color
    Color darkBg = conf.gui.colors.background.darker(); // darker() is a method of Color

    // you can handle groups of fields at once
    Connection dbConnection = getConnection(conf.db);
    // in fact, the class org.example.Conf wraps the class org.example.Conf.Db and others
</pre></div></div>
<p>To achieve this, you can create the target class by hand, but it is much more easy to generate it automatically from the property file, that serves as a template.</p>
<p><a name="template"></a></p></div>
<div class="section">
<h3><a name="Creating_the_template_property_file"></a>Creating the template property file</h3>
<p>The <b>template property file</b> aims to describe the shape of the target structure thanks to example values and additional indications for the <a href="#generator">generator</a> that will create the Java source code of that class(es).</p>
<p>Create a copy of &#x201c;<tt>conf.properties</tt>&#x201d; to &#x201c;<tt>conf.template.properties</tt>&#x201d; and apply the following modifications to that template.</p>
<p><a name="directives"></a></p>
<div class="section">
<h4><a name="Directives"></a>Directives</h4>
<p>First, create a new entry at the top, in order to indicate the fully qualified name of the target class to generate :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
. = #org.example.Conf
</pre></div></div>
<p><tt>.</tt> is used as a special key for few directives that drives the code generation. <tt>#org.example.Conf</tt> stands for the class name to create.</p>
<p>Let&#x2019;s examine the other values.</p>
<p><a name="primitives"></a></p></div>
<div class="section">
<h4><a name="Primitives"></a>Primitives</h4>
<p>The right type will be used according to the value supplied in the template property file. For example, if we find <tt>true</tt> or <tt>false</tt>, the field will be a <tt>boolean</tt> (with that default value), if we find a list of booleans, e.g. <tt>true, false, false</tt> the field will be a <tt>java.util.List&lt;java.lang.Boolean&gt;</tt>.</p>
<p>In our template we have :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window.width = 500
</pre></div></div>
<p>You don&#x2019;t need to change anything, <tt>500</tt> is a number, and the field <tt>width</tt> will be a <tt>short</tt>. The more suitable number type will be used, therefore if you want a <tt>byte</tt>, use a value in that range (lower than 128), if you want a <tt>float</tt>, use a decimal in the value, etc.</p>
<p>If you want to force the type regardless the value, you can also write its type before the value :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window.width = $int 500
</pre></div></div>

<div class="alert alert-info" role="alert">
Note that we use <tt>$</tt> for an existing type rather than a <tt>#</tt> for a type to create like the main class type.
</div>
<p><a name="uris"></a></p></div>
<div class="section">
<h4><a name="URIs"></a>URIs</h4>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.url = https://some-services.example.org/someService
</pre></div></div>
<p>You don&#x2019;t need to change anything, &#x201c;<tt>https://some-services.example.org/someService</tt>&#x201d; is an URI, and the field <tt>url</tt> will be a <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/net/URI.html"><tt>java.net.URI</tt></a>.</p>
<p><a name="strings"></a></p></div>
<div class="section">
<h4><a name="Strings"></a>Strings</h4>
<p>Similarly, the <tt>db.url</tt> is also an URI :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.url = jdbc:fakesql://localhost:3306/localdb?autoReconnect=true
</pre></div></div>
<p>But imagine we want it as a <tt>java.lang.String</tt>, we can surround it between double quotes to force it to be a <tt>java.lang.String</tt> instead of a <tt>java.net.URI</tt>:</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.url = &quot;jdbc:fakesql://localhost:3306/localdb?autoReconnect=true&quot;
</pre></div></div>
<p>Similarly, every time we found a character used to introduce a directive, we can ignore everything by using double quotes around that value.</p>
<p>Finally, if no recipe is applicable, a <tt>java.lang.String</tt> will be assumed :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.account.login = theLogin
</pre></div></div>
<p><a name="classes"></a></p></div>
<div class="section">
<h4><a name="Classes"></a>Classes</h4>
<p>For the database driver, we expect having an existing <tt>java.lang.Class</tt>. We can enforce that by prepending the value with <tt>java:</tt> in the template :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.driver = java:com.fakesql.jdbc.Driver
</pre></div></div>
<p>In your program, no more need of an additional <tt>Class.forName(&quot;com.fakesql.jdbc.Driver&quot;);</tt>, it is performed by the loader. Be aware that the class referred must be of the type given, therefore, a more general type should be specified in the template :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.driver = java:java.sql.Driver
</pre></div></div>
<p>or if you don&#x2019;t really know what will be the concrete type in the property, just use a wildcard in the template : 
<div class="source"></p>
<div class="source">
<pre class="prettyprint properties"> db.driver = java:? </pre></div></div>
<p>Note that an entry such as :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
jndi.ds = java:/comp/env/jdbc/someDB
</pre></div></div>
<p>wouldn&#x2019;t be considered as a Java class, but as a <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/net/URI.html"><tt>java.net.URI</tt></a>.</p>
<p><a name="passwords"></a></p></div>
<div class="section">
<h4><a name="Passwords"></a>Passwords</h4>
<p>The password should not be left as-is in that template, replace the value by <tt>*****</tt> to get a <tt>char[]</tt> field (it is a bad practice to store passwords in Strings)</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db.account.password = *****
</pre></div></div>

<div class="alert alert-info" role="alert">
Instead of getting a <tt>char[]</tt> field, it is possible to get a secure <tt><a href="../apidocs/ml/alternet/security/Password.html">ml.alternet.security.Password</a></tt>.
To achieve this, simply add the Maven declaration in your build :


<div>
<pre>
&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>

You also have to write your own adapter (see below). Note that since such password live aside the application in a configuration file, using that secure password has not so much advantages. Note also that they will be built from a <tt>java.lang.String</tt>, not from a <tt>char[]</tt>.

</div>
<p><a name="adapters"></a></p></div>
<div class="section">
<h4><a name="Other_types_adapters_and_other_directives"></a>Other types, adapters, and other directives</h4>
<p>Finally, we need to supply an adapter for the colors. First, indicates what is the type of the field by prepending the special notation <tt>$java.awt.Color</tt> before the actual value :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.colors.background = $java.awt.Color #FFFFFF
</pre></div></div>
<p>Then, we need to supply an adapter, and tell the generator to use that adapter. An adapter is just a function that takes a <tt>java.lang.String</tt> and parse it to get an instance of the expected type ; our adapter is just a <tt>java.util.function.Function&lt;java.lang.String, java.awt.Color&gt;</tt>, and such function already exist, it is <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/awt/Color.html#decode-java.lang.String-"><tt>java.awt.Color::decode</tt></a>.</p>
<p>To bind that adapter to the target class, we would write this Java code :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    Adapter.map(Color.class, Color::decode) // when a Color type is expected, parse the text with Color.decode()
</pre></div></div>
<p>The <a href="apidocs/ml/alternet/properties/Binder.Adapter.html"><tt>ml.alternet.properties.Binder.Adapter</tt></a> class comes with convenient static methods to bind a class or a property name to an adapter function, or even a regular expression of a property name. It is also possible to map items from a list.</p>
<p>We will insert the above Java code inside our template, by using 2 others directives, the former to import the <tt>Color</tt> class, the latter to generate an unmarshaller with that adapter ; similarly, we also need an adapter for UUID :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# directives for importing the required types
. = !java.awt.Color
. = !java.util.UUID
# directives for getting adapters
. = @Adapter.map(Color.class, Color::decode)
. = @Adapter.map(UUID.class, UUID::fromString)
</pre></div></div>
<p>and accordingly, setting the type on the property definition :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.uuid = $java.util.UUID 5da66c77-7062-4b30-97fc-e747eb64570a
</pre></div></div>
<p><a name="unmarsaller"></a></p></div>
<div class="section">
<h4><a name="Unmarshaller"></a>Unmarshaller</h4>
<p>When a directive for getting an adapter is present, some convenient methods are added to the target class for unmarshalling a property file to an instance of that class :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    Conf conf = Conf.unmarshall(new FileInputStream(&quot;conf.properties&quot;));
</pre></div></div>
<p>If we don&#x2019;t have any adapter, it is recommended to add the <tt>. = @</tt> directive in order to generate the methods :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    // if you use the &quot;.=@&quot; directive, this method will be generated for you
    // otherwise, this is what you have to write to get an instance of your
    // class from a property file
    public static Conf unmarshall(InputStream properties) throws IOException {
        return Binder.unmarshall(
            properties,
            Conf.class
        );
    }
</pre></div></div>
<p><a name="intermediateTypes"></a></p></div>
<div class="section">
<h4><a name="Intermediate_types"></a>Intermediate types</h4>
<p>In fact, each time a property contains a dot in its name, it is breakdown in classes. That way the property name <tt>gui.colors.background</tt> creates the <tt>org.example.Conf.Gui</tt> class and the <tt>org.example.Conf.Gui.Colors</tt> class in the same Java source file.</p>
<p>Since no intermediate Java names called <tt>UUID</tt> or <tt>Color</tt> are in the scope of our property definitions, the type specified in the values will be automatically imported ; consequently, the import directives <tt>. = !java.awt.Color</tt> and <tt>. = !java.util.UUID</tt> may be discarded in our case.</p>
<p>Conversely, if we had a property like this (note that <tt>gui.colors</tt> have been changed to <tt>gui.color</tt>) :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.color.background = $java.awt.Color #FFFFFF
</pre></div></div>
<p>we would have an intermediate type <tt>org.example.Conf.Gui.Color</tt> that would mask the <tt>Color</tt> type name for the <tt>background</tt> field ; therefore the field type in the Java code generated will be written with its fully qualified name <tt>java.awt.Color</tt>, and that name won&#x2019;t be automatically imported, whereas it is also used in the adapter. If a type is used in the adapter and not automatically imported, you have to write the import directive in the template.</p>
<p>Well, if you don&#x2019;t know whether to import a type or not, don&#x2019;t worry, the compiler will let you know after trying to <a href="#generator">generate</a> your class : first, omit the imports, then <a href="#generator">generate</a> the class and have a look at the compiler for the missing imports, and then, add them to the template, and try again !</p></div>
<div class="section">
<h4><a name="The_final_property_template_file"></a>The final property template file</h4>
<p>The final property template &#x201c;<tt>conf.template.properties</tt>&#x201d; looks like this :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# Target class name
. = #org.example.Conf
# Required adapters
. = @Adapter.map(Color.class, Color::decode)
. = @Adapter.map(UUID.class, UUID::fromString)

# Properties definining the GUI
gui.window.width = $int 500
gui.window.height = 300
gui.colors.background = $java.awt.Color #FFFFFF
gui.colors.foreground = $java.awt.Color #000080

# Properties definining datasources
service.url = https://some-services.example.org/someService
service.uuid = $java.util.UUID 5da66c77-7062-4b30-97fc-e747eb64570a

db.driver = java:java.sql.Driver
db.url = &quot;jdbc:fakesql://localhost:3306/localdb?autoReconnect=true&quot;
db.account.login = theLogin
db.account.password = *****
</pre></div></div>
<p>The next step is to <a href="#generator">generate</a> the target class from that template. But let&#x2019;s examine before other kind of types that you can use in your templates.</p>
<p><a name="files"></a></p></div>
<div class="section">
<h4><a name="Files"></a>Files</h4>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
files.help = file:///path/to/help.txt
</pre></div></div>
<p>You don&#x2019;t need to change anything, <tt>file:///path/to/help.txt</tt> is a file path, and the field <tt>help</tt> will be a <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html"><tt>java.io.File</tt></a>.</p>
<p><a name="datesTimes"></a></p></div>
<div class="section">
<h4><a name="Dates_and_times"></a>Dates and times</h4>
<p>Dates, times, and date-times without time-zone in the ISO-8601 calendar system such as (respectively) <tt>2007-12-03</tt>, <tt>10:15:30</tt>, and <tt>2007-12-03T10:15:30</tt> are giving (respectively) <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html"><tt>java.time.LocalDate</tt></a>, <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalTime.html"><tt>java.time.LocalTime</tt></a>, and <a class="externalLink" href="https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html"><tt>java.time.LocalDateTime</tt></a> :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
schedule.launch : 2007-12-03
schedule.reload : 10:15:30
</pre></div></div>
<p><a name="lists"></a></p></div>
<div class="section">
<h4><a name="Lists"></a>Lists</h4>
<p>If several values are separated by a comma, the field will be a list :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.colors.pie = $java.awt.Color #FF0000, #00FF00, #0000FF
</pre></div></div>
<p>gives a <tt>java.util.List&lt;java.awt.Color&gt;</tt>.</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.fonts.size = $int 12, 16, 24
</pre></div></div>
<p>gives a <tt>java.util.List&lt;java.lang.Integer&gt;</tt>.</p>
<p><a name="enums"></a></p></div>
<div class="section">
<h4><a name="Enums"></a>Enums</h4>
<p>If several values are separated by a pipe, the field will be an enum :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.status = PENDING | ACTIVE | INACTIVE | DELETED
</pre></div></div>
<p>This will generate the enum <tt>org.example.Conf.Service.Status</tt>.</p>
<p>When the same enum is used several time, we can refer to it with its name, just like other properties that refer to an existing type :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
plugin.status = $org.example.Conf.Service.Status PENDING | ACTIVE | INACTIVE | DELETED
</pre></div></div>
<p>(in the last example, the enum has been generated once, next we are referring that existing class with <tt>$</tt>; of course you are not compelled to repeat the values since the type is already define elsewhere, they are here just for documenting the template)</p>
<p>A comma after the enumeration gives a list, e.g :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
plugin.multipleStatus = $org.example.Conf.Service.Status PENDING | ACTIVE | INACTIVE | DELETED, ACTIVE
</pre></div></div>
<p>gives a <tt>java.util.List&lt;org.example.Conf.Service.Status&gt;</tt>. That comma can also be set on the enum definition like this :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.multipleStatus = PENDING | ACTIVE | INACTIVE | DELETED, ACTIVE
</pre></div></div>
<p>Sometimes we expect the enum class to be generated with a different name than the name of the field; below, we don&#x2019;t want an enum named <tt>org.example.Conf.Service.StartState</tt>, we prefer having <tt>org.example.Conf.Service.Status</tt> :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.startState = #Status PENDING | ACTIVE | INACTIVE | DELETED
</pre></div></div>
<p>Sometimes we expect the enum class to be generated in its own file. To achieve this, write the fully qualified type name followed by the values :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
service.status = #org.example.Status PENDING | ACTIVE | INACTIVE | DELETED
</pre></div></div>
<p><a name="unknownKeys"></a></p></div>
<div class="section">
<h4><a name="Unknown_keys"></a>Unknown keys</h4>
<p>Sometimes, a property file contains names that are not known in advance :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
map.paris.geo = 48.864716, 2.349014
map.london.geo = 51.509865, -0.118092
map.istanbul.geo = 41.015137, 28.979530
</pre></div></div>
<p>The template properties file may set a star character at the place of this field :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
map.*.geo = $org.example.Geo 48.864716, 2.349014
</pre></div></div>
<p>This will generate a special method that allow to retrieve a property by name. You also have to map that key to its adapter like this :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
. = @Adapter.map(&quot;map.*.geo&quot;, Geo::parse)
</pre></div></div>
<p>In your program, the special <a href="apidocs/ml/alternet/properties/$.html#Z:Z:D-java.lang.String-"><tt>$()</tt> method</a> generated will allow to retreive the keys like this :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    long dist = conf.map.&lt;Geo&gt; $(&quot;paris.geo&quot;)
                    .computeDistance(conf.map.&lt;Geo&gt; $(&quot;istanbul.geo&quot;));
</pre></div></div>
<p>That <tt>map</tt> property may also contains other predefined fields if needed. Those fields are not reachable with the <tt>$()</tt> method ; that method allow to retrieve only fields that are not predefined.</p>
<p><a name="typesWithValue"></a></p></div>
<div class="section">
<h4><a name="Types_with_value"></a>Types with value</h4>
<p>Sometimes, there is a value as well as subproperties ; they have to be specified in the template property file as well :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window = Sample application
gui.window.width = $int 500
gui.window.height = 300
</pre></div></div>
<p>In your program, the field <tt>conf.gui.window</tt> gives an instance of <tt>org.example.Conf.Gui.Window</tt> with the fields <tt>width</tt> and <tt>height</tt>, and an additional field <tt>$</tt> that contains the value <tt>Sample application</tt> (a <tt>java.lang.String</tt> in that case, but any other type is allowed) :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    System.out.println(conf.gui.window.$); // print &quot;Sample application&quot;
</pre></div></div>
<p><a name="separateTypes"></a></p></div>
<div class="section">
<h4><a name="Separate_types"></a>Separate types</h4>
<p>In order to create a separate type (like for enums), write its type at the group level. The group level represents the class to create, and <b>ends with a dot</b>, like <tt>gui.window.</tt> :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window. = #org.example.Window
gui.window.width = $int 500
gui.window.height = 300
</pre></div></div>
<p>And without a fully qualified name, it&#x2019;s just a renaming from <tt>org.example.Conf.Gui.Window</tt> to <tt>org.example.Conf.Gui.Application</tt> :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window. = #Application
gui.window.width = $int 500
gui.window.height = 300
</pre></div></div>
<p>Do not confuse with the self value, that may also have its own type :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
gui.window = $java.lang.String Sample application
gui.window. = #org.example.Gui
gui.window.width = $int 500
gui.window.height = 300
</pre></div></div>
<p><a name="rules"></a></p></div>
<div class="section">
<h4><a name="Rules_for_types"></a>Rules for types</h4>

<ul>
  
<li><tt>#org.example.Gui</tt> means that we want to create a type that will hold all child properties.</li>
  
<li><tt>$java.awt.Color</tt> means that want a field that refers to an <b>existing type</b>.</li>
  
<li><tt>#Application</tt> means that we want to create a type with that name instead of the name of the property.</li>
</ul>
<p>Except for renaming, always write classes with their fully qualified name. The Java source generated will take care of classes to import or not.</p>
<p>The directives <tt>. = @Adapter.map()</tt> are strings that may refer to other types ; those other types have to be explicitly imported with the <tt>. = !org.acme.Foo</tt> directive. Even when a type is explicitly imported, its name must be fully qualified in <tt>$</tt> references.</p>
<p><a name="generator"></a></p></div></div>
<div class="section">
<h3><a name="Generating_the_target_class"></a>Generating the target class</h3>
<p>The <a href="apidocs/ml/alternet/properties/Generator.html"><tt>ml.alternet.properties.Generator</tt></a> class can be used to generate the target classes from the template properties files :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    File propertiesTemplatesDirectory = new File(&quot;file:///path/to/templates-dir/&quot;);
    File outputDirectory = new File(&quot;file:///path/to/target-dir/&quot;);
    new Generator()
        .setPropertiesTemplatesDirectory(propertiesTemplatesDirectory)
        .setOutputDirectory(outputDirectory)
        .generate();
</pre></div></div>
<p>But it is more easy to use the Maven plugin in <tt>pom.xml</tt>.</p>
<p><a name="maven"></a></p>
<div class="section">
<h4><a name="Generating_the_target_class_with_Maven"></a>Generating the target class with Maven</h4>
<p>This <a href="../prop-bind-maven-plugin/index.html">Maven Plugin</a> aims to create a bunch of classes that can be populated by <tt>.properties</tt> files :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">  &lt;build&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
        &lt;artifactId&gt;alternet-tools&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
        &lt;artifactId&gt;prop-bind-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
        &lt;configuration&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;?m2e execute?&gt;
            &lt;id&gt;generate&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;generate&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
</pre></div></div>
<p>The plugin accepts the parameters <tt>propertiesDirectory</tt> and <tt>outputDirectory</tt> that are set by default to, respectively, &#x201c;<tt>${basedir}/src/main/properties</tt>&#x201d; and &#x201c;<tt>${project.build.directory}/generated-sources/prop-bind</tt>&#x201d;.</p>
<p>It will scan recursively the input directory and generate the Java source code in the output directory for each <tt>.properties</tt> file.</p>

<ul>
  
<li>Don&#x2019;t omit to add that directory to the Java source directories. In your IDE, such as Eclipse, you should edit the properties of your project and in &#x201c;Java Build Path&#x201d; add that directory to the sources.</li>
  
<li>With Maven, the output directory will be added automatically to the sources to compile.</li>
</ul>
<p><a name="otherFeatures"></a></p></div></div>
<div class="section">
<h3><a name="Other_features"></a>Other features</h3>
<p><a name="default"></a></p>
<div class="section">
<h4><a name="Default_values"></a>Default values</h4>
<p>Before loading the property file, all the fields are empty (default value for primitives and null for objects), except for booleans that takes as a default value the one present in the template.</p>
<p>If you don&#x2019;t like default values for primitives, use the counterpart boxed type instead :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# the property will be null if the value is missing in the properties file
gui.window.width = $java.lang.Integer 500
</pre></div></div>
<p>It is possible to use an existing object with default values, and load on it the property file. A typical usage would to use system properties as default values, which allow to pass default values when launching Java : <tt>-Dgui.window.height = 500</tt> :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    # start with the default System conf
    Conf conf = Conf.unmarshall(System.getProperties());
    # update with other values
    conf.update(new FileInputStream(&quot;conf.properties&quot;));
</pre></div></div>
<p>or if you prefer to read first <tt>conf.default.properties</tt> and last to override the values with the System properties :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    # start with the default conf
    Conf conf = Conf.unmarshall(new FileInputStream(&quot;conf.default.properties&quot;));
    # go on with other values
    conf.update(new FileInputStream(&quot;conf.properties&quot;));
    # finish by overriding with System properties
    conf.update(System.getProperties());
</pre></div></div>
<p><a name="merging"></a></p></div>
<div class="section">
<h4><a name="Merging_separate_property_files"></a>Merging separate property files</h4>
<p>When loading properties, instead of having a single property file, it is possible to have multiple source files :</p>

<ul>
  
<li>&#x201c;<tt>conf.properties</tt>&#x201d; :</li>
</ul>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# Properties definining the GUI
gui.window.width = 500
gui.window.height = 300
gui.colors.background = #FFFFFF
gui.colors.foreground = #000080

# Properties definining datasources
service.url = https://some-services.example.org/someService
service.uuid = 5da66c77-7062-4b30-97fc-e747eb64570a

db = file:datasource/db.properties
</pre></div></div>

<ul>
  
<li>&#x201c;<tt>datasource/db.properties</tt>&#x201d; :</li>
</ul>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# Properties definining DB datasource
driver = com.fakesql.jdbc.Driver
url = jdbc:fakesql://localhost:3306/localdb?autoReconnect=true
account.login = theLogin
account.password = thePassword
</pre></div></div>
<p>Accessing a property in your Java program remains unchanged :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    if (&quot;admin&quot;.equals(conf.db.account.login)) {
        // TODO
    }
</pre></div></div>
<p>The file may be either a relative path <b>relative to the current directory</b> or an absolute path :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db = file:relative/path/to/db.properties
</pre></div></div>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
db = file:///absolute/path/to/db.properties
</pre></div></div>
<p><a name="interpolation"></a></p></div>
<div class="section">
<h4><a name="Variable_interpolation"></a>Variable interpolation</h4>
<p>Variable interpolation is available with Java EE Expression Language. In order to use this feature, the following dependency have to be added :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    &lt;dependency&gt;
        &lt;groupId&gt;org.glassfish&lt;/groupId&gt;
        &lt;artifactId&gt;javax.el&lt;/artifactId&gt;
        &lt;version&gt;3.0.1-b09&lt;/version&gt;
    &lt;/dependency&gt;
</pre></div></div>
<p>Only the variables already set can be referred :</p>

<div class="source">
<div class="source">
<pre class="prettyprint properties">
# Properties definining the GUI
gui.window.height = 300
gui.window.width = ${gui.window.height + 200}
gui.colors.background = #F0F1F2
gui.colors.foreground = ${gui.colors.background.brighter()}
</pre></div></div>
<p><a name="renaming"></a></p></div>
<div class="section">
<h4><a name="Automatic_renaming"></a>Automatic renaming</h4>
<p>If a property name is in conflict with Java naming rules (use of illegal characters, use of a keyword, name already existing in the same scope), the generator will create a valid name derived from the original name for you.</p>
<p>The generator will fail if the name is made of only illegal characters : in that case, just use a nice name for your properties.</p></div></div></div>
        </div>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>Copyright &copy;2018
<a href="http://alternet.ml">Alternet</a>.
All rights reserved.</p>
        </div>
        <p id="poweredBy" class="pull-right">  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
  </p>
        </div>
    </footer>
    </body>
</html>
