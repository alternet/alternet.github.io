<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-08-30 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170830" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Alternet Tools &#x2013; Alternet Tools</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
            <div class="container"><div class="nav-collapse">
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../" title="Home">Home</a></li>
            <li><a href="https://github.com/alternet/alternet-libs" title="GitHub project">GitHub project</a></li>
            <li><a href="http://semantic-mismatch.blogspot.fr/" title="Blog">Blog</a></li>
            <li><a href="../release-notes.html" title="Release notes">Release notes</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../download.html" title="Download">Download</a></li>
            <li><a href="../license.html" title="License">License</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../parsing/index.html" title="Alternet Parsing">Alternet Parsing</a></li>
            <li><a href="../scanner/index.html" title="Alternet Scanner">Alternet Scanner</a></li>
            <li><a href="../security/index.html" title="Alternet Security">Alternet Security</a></li>
            <li><a href="../tools/index.html" title="Alternet Tools">Alternet Tools</a></li>
            <li><a href="../tools-generator/index.html" title="Alternet Tools - Generator">Alternet Tools - Generator</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Maven reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="project-summary.html" title="Summary">Summary</a></li>
                  <li><a href="license.html" title="Licenses">Licenses</a></li>
                  <li><a href="team-list.html" title="Team">Team</a></li>
                  <li><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="issue-tracking.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="xref/index.html" title="Source Xref">Source Xref</a></li>
                  <li><a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
                  <li><a href="surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="cpd.html" title="CPD">CPD</a></li>
                  <li><a href="pmd.html" title="PMD">PMD</a></li>
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
              </ul>
                    <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://github.com/alternet/alternet.ml" title="GitHub project">GitHub project</a></li>
    <li><a href="../demo.html" title="Other Demos">Other Demos</a></li>
                </ul>
              </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>Alternet Tools</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-08-30<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0<span class="divider">|</span></li>
        <li class=""><a href="../.." title="Alternet">Alternet</a><span class="divider">»</span></li>
      <li class=""><a href="../index.html" title="Alternet Libs">Alternet Libs</a><span class="divider">»</span></li>
      <li class=""><a href="index.html" title="Alternet Tools">Alternet Tools</a><span class="divider">»</span></li>
    <li class="active ">Alternet Tools</li>
        </ul>
      </div>
        <div id="bodyColumn" >
<h1>Alternet Tools</h1>
<p>Alternet Tools include discovery service tools, concurrent and locking tools, and more.</p>
<div class="section">
<h2><a name="Maven_import"></a>Maven import</h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-tools&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h2><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h2>

<ul>
  
<li><a href="apidocs/index.html">Alternet Tools</a></li>
</ul>
<p>Other Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul></div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>Alternet Tools contains mainly :</p>

<ul>
  
<li>a discovery service that can be optionally used with injection (JSR330)</li>
  
<li>concurrent and locking tools</li>
  
<li><a href="../tools-generator/generator.html">a class generator</a></li>
  
<li>and additional utility classes</li>
</ul>
<p>This documentation covers the two formers ; please consult the <a href="apidocs/index.html">Javadoc API</a> for the latter.</p></div>
<div class="section">
<h2><a name="Discovery_Service"></a>Discovery Service</h2>
<p>The <a href="apidocs/ml/alternet/discover/DiscoveryService.html">DiscoveryService</a> class is a component for retrieving classes that support the following features :</p>

<ul>
  
<li>several variant implementations can be defined aside</li>
  
<li>automatic generation of the bindings</li>
  
<li>support of injection (JSR330) with :</li>
  
<li>
  
<ul>
    
<li>out-of-the-box pre-defined qualifier</li>
  </ul></li>
  
<li>
  
<ul>
    
<li>automatic generation of producer classes</li>
  </ul></li>
</ul></div>
<div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>Consider that &#x201c;<tt>Protocol</tt>&#x201d; is an interface ; a specific variant of this interface can be retrieved with :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    Protocol protocol = DiscoveryService.newInstance(&quot;org.acme.Protocol/http&quot;);
</pre></div></div>
<p>The more convenient way to bind an implementation is to define the file <tt>META-INF/xservices/org.acme.Protocol/http</tt> that might contain :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">org.acme.protocols.HttpProtocol
</pre></div></div>
<p>but other means to retrieve an implementation are also available (see below). Note that <tt>META-INF/xservices/</tt> resources can be generated automatically (see below).</p>
<div class="section">
<h3><a name="Lookup_keys_and_variants"></a>Lookup keys and variants</h3>
<p>The lookup key is usually the fully qualified name of a class (usually abstract or an interface) : <tt>org.acme.Protocol</tt>, and the resolved class name should be a concrete implementation of it; the lookup key can also be a name, even a JNDI name.</p>
<p>Inner class names contains a $ sign in their name ; all lookup are performed on keys where the $ sign is replace by a dot. If you define manually a <tt>META-INF/xservices/</tt> entry, don&#x2019;t write file names or directory names with a dollar, but with a dot instead.</p>
<p>The lookup key can be supplied with a variant, in order to bind several implementations (this has to be taken in charge by the caller); for example, <tt>org.acme.SerializerFactory/image/png</tt>. Basically, it means that we want a factory that can supply a serializer for <tt>image/png</tt>.</p>

<ul>
  
<li>An implementation can be render either as a raw <tt>Class</tt> or as a singleton instance (or both across multiple calls)</li>
  
<li>The class lookup is done <i>once</i> for every class name to discover.</li>
  
<li>Singletons are instanciated by their own method &#x201c;<tt>newInstance()</tt>&#x201d; if they have one, or by their default zero argument constructor. If the singleton fails to instanciate, the user would still have the possibility to get the raw class and build itself an instance.</li>
</ul></div>
<div class="section">
<h3><a name="Class_localization"></a>Class localization</h3>
<p>An implementation is looked up from the key supplied as follows (in order):</p>

<ol style="list-style-type: decimal">
  
<li>The value of the system property with the name of the key supplied if it exists and is accessible.</li>
  
<li>The value of the JNDI property with the name of the key supplied prepend with <tt>java:comp/env/</tt> if it exists and is accessible; if the resolved object is a string, it stands for a class name, otherwise for the instance to return.</li>
  
<li>The value of the init parameter of the Web application with the name of the key supplied if it exists and is accessible (&lt;web-app&gt; &lt;context-param&gt;) During its initialization, the web application must have registered a filter <tt>ml.alternet.web.WebFilter</tt>.</li>
  
<li>The contents of the file <tt>discoveryService.properties</tt> of the current directory if it exists.</li>
  
<li>The contents of the file <tt>$USER_HOME/discovery-service.properties</tt> if it exists.</li>
  
<li>The contents of the file <tt>$JAVA_HOME/jre/lib/discovery-service.properties</tt> if it exists.</li>
  
<li>The Jar Service Provider discovery mechanism specified in the Jar File Specification, and ammended by the special use of this class (see below). A jar file can have a resource (i.e. an embedded file) such as <tt>META-INF/xservices/package.Class</tt> (or <tt>META-INF/xservices/package.Class/variant</tt> if the key contains a variant) containing the name of the concrete class to instantiate.</li>
  
<li>The fallback default implementation, which is given by the <tt>META-INF/xservices/</tt> of the user library (services found with a line of comment before or ending with a comment that contains <tt># default</tt> will be processed at the end)</li>
</ol>
<p>The first value found is returned. If one of those method fails, the next is tried.</p></div>
<div class="section">
<h3><a name="META-INF_services_and_xservices"></a><tt>META-INF</tt> services and xservices</h3>
<p>The location used by this tool is <tt>META-INF/xservices/</tt>, not <tt>META-INF/services/</tt>. Actually, the common <tt>META-INF/services/</tt> directory is ruled by different conventions than those used here (specifically due to the &#x201c;variant&#x201d; of the key). To avoid confusion, another directory name has been retained, actually `xservices``(that stands for &#x201c;extended services&#x201d;).</p></div>
<div class="section">
<h3><a name="Self-registration"></a>Self-registration</h3>
<p>The <a href="apidocs/ml/alternet/discover/LookupKey.html">@LookupKey</a> annotation can be used in order to generate automatically an entry under <tt>META-INF/xservices/</tt> :</p>
<p>When no variant is specified, the annotation : </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@LookupKey(impClass=org.acme.tools.ToolsImpl.class)
interface Tools {
    // ... 
}
</pre></div></div>
<p>&#x2026;will generate the entry in <tt>META-INF/xservices/org.acme.tools.Tools</tt> that contains :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums"> # default
 org.acme.tools.ToolsImpl
</pre></div></div>
<p>A variant can also be specified in the lookup key annotation. The default directive can be unset. The annotation can be placed on the target implementation.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@LookupKey(impClass=org.acme.protocols.HttpProtocol.class, variant=&quot;http&quot;)
interface Protocol {
    // ...
}
</pre></div></div>
<p>&#x2026;will generate the entry in <tt>META-INF/xservices/org.acme.Protocol/http</tt> that contains :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums"> # default
 org.acme.protocols.HttpProtocol
</pre></div></div></div>
<div class="section">
<h3><a name="Injection"></a>Injection</h3>
<p>Two additional annotations can also be used with a CDI container (JSR330).</p>
<p>The discovery service can be used without a CDI container, but if you want to inject classes to lookup (specifically with a variant), the annotations supplied may help.</p>
<p>Even if you used a CDI container, you are not compelled to inject every classes to lookup, just the ones you want to or have to inject.</p>

<ul>
  
<li>As mentioned previously, <a href="apidocs/ml/alternet/discover/LookupKey.html">@LookupKey</a> generates an entry in <tt>META-INF/xservices/</tt></li>
</ul>
<p>Additionally :</p>

<ul>
  
<li><a href="apidocs/ml/alternet/discover/Injection.LookupKey.html">@Injection.LookupKey</a> qualifies an instance to inject</li>
  
<li><a href="apidocs/ml/alternet/discover/Injection.Producer.html">@Injection.Producer</a> generates a class producer for injections</li>
</ul>
<div class="section">
<h4><a name="Example_:_start_situation_without_injection"></a>Example : start situation (without injection)</h4>
<p>For example, consider a constructor :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">public A(B b) {
    // ...
}
</pre></div></div>
<p>where B is an interface :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">public interface B {
    // ...
}
</pre></div></div>
<p>which has several implementations :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@LookupKey(forClass = B.class, variant = &quot;greedy&quot;)
public class B1 implements B {
    // ...
}
</pre></div></div>
<p>and :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@LookupKey(forClass = B.class, variant = &quot;lazy&quot;)
public class B2 implements B {
   // ...
}
</pre></div></div>
<p>You want to inject the right class ? See below&#x2026;</p></div>
<div class="section">
<h4><a name="Target_situation_with_injection"></a>Target situation (with injection)</h4>
<p>First, in the constructor (or directly in the field, up to you) one have to indicates that an instance have to be injected :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@javax.inject.Inject
public A(@Injection.LookupKey(&quot;standard&quot;) B b) {
    // ...
}
</pre></div></div>
<p>Then you have to set on the interface which variant you want to produce :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@Injection.Producer(variant = &quot;standard&quot;, lookupVariant=&quot;lazy&quot;)
public interface B {
    // ...
}
</pre></div></div>
<p>A producer class will be generated at compile time, that will perform the lookup with the specified variant. At runtime, the container will inject the instance supplied by the producer that matches both the expected target class and the variant, if any.</p></div>
<div class="section">
<h4><a name="Other_usage"></a>Other usage</h4>
<p>It is also possible to omit the variant to inject.</p>
<p>It is also possible to use the same variant at the injection point :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@javax.inject.Inject
public A(@Injection.LookupKey(&quot;lazy&quot;) B b) {
    // ...
}
</pre></div></div>
<p>&#x2026;and accordingly to generate a relevant producer :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@Injection.Producer(variant = &quot;lazy&quot;)
public interface B {
    // ...
}
</pre></div></div>
<p>Sometimes, the developer doesn&#x2019;t own the type to inject neither their implementations ; it is still possible to set the annotations on some code owned by the developer, for example one of its package and specify both the implementation and the target class.</p></div></div></div>
<div class="section">
<h2><a name="Concurrent_and_locking_tools"></a>Concurrent and locking tools</h2>
<p>The concurrent package allows to manage mutexes and locks, based on a string ID, safe for synchronization for a given user context.</p>
<p>As mentionned in section 3.10.5 of the Java Language Spec 2.0 :</p>

<blockquote>
<p>&#x201c;Literal strings within different classes in different packages likewise represent references to the same String object.&#x201d;</p>
</blockquote>
<p>The <a href="apidocs/ml/alternet/concurrent/MutexContext.html">MutexContext</a> class allow to create a context in order to manage safe string-based mutexes, that is to say without the inherent conditions of the String class that can lead to a dead-lock.</p>
<p>This class is not magic:</p>

<ul>
  
<li>It&#x2019;s up to the user to create a context per domain to avoid ID collisions. The scope of such domain depends on the application.</li>
  
<li>It can&#x2019;t avoid dead-lock due to programming (it only avoids the inherent possibility of dead-locks due to string usage)</li>
</ul>
<p>A mutex or a lock doesn&#x2019;t have to be explicitly remove from its context, it will be automatically removed after all references to it are dropped.</p>
<div class="section">
<h3><a name="Usage"></a>Usage</h3>

<div class="source">
<div class="source"><pre class="prettyprint linenums">   MutextContext mutexContext = new MutextContext();
   // ...
   
   String id = someObject.getCanonicalID();
   Mutex mutex = mutexContext.getMutex(id);
   synchronized(mutex) {
      // ...
   }
</pre></div></div>
<p>Instead of synchronizing on a <a href="apidocs/ml/alternet/concurrent/Mutex.html">Mutex</a> it is also possible to get one of the available lock :</p>

<ul>
  
<li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getLock-java.lang.String-">Lock</a></li>
  
<li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getReadWriteLock-java.lang.String-">ReadWriteLock</a></li>
  
<li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getStampedLock-java.lang.String-">StampedLock</a></li>
</ul></div></div>
        </div>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>Copyright &copy;2017
<a href="http://alternet.ml">Alternet</a>.
All rights reserved.</p>
        </div>
        <p id="poweredBy" class="pull-right">  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
  </p>
        </div>
    </footer>
    </body>
</html>
