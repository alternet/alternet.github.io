
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2014-09-24
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Alternet Tools | Alternet Tools</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cerulean/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/solarized_dark.min.css" rel="stylesheet" />

		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="author" href="https://plus.google.com/108799833576409207321"/>
	</head>

	<body class="page-tools project-alternet-tools" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="../.."><span class="color-highlight">Alternet</span> Libs</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../download.html" title="Download">Download</a></li>
							<li ><a href="https://github.com/alternet/alternet-ml" title="GitHub project" class="externalLink">GitHub project</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../scanner/index.html" title="Alternet Scanner">Alternet Scanner</a></li>
									<li ><a href="../security/index.html" title="Alternet Security">Alternet Security</a></li>
									<li ><a href="../tools/index.html" title="Alternet Tools">Alternet Tools</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../../" id="bannerLeft"><h1><span class="color-highlight">Alternet</span> Libs</h1></a>
					<p class="lead">Common Alternet Libraries</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li><a href="../../" title="Alternet">Alternet</a></li>
				<li class="divider">/</li>
				<li><a href="../index.html" title="Alternet Libs">Alternet Libs</a></li>
				<li class="divider">/</li>
				<li><a href="index.html" title="Alternet Tools">Alternet Tools</a></li>
				<li class="divider">/</li>
				<li>Alternet Tools</li>
			</ul>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar" data-spy="affix" data-offset-top="250">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#toc-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="toc-nav-collapse">
						<ul id="toc" class="nav">
						<li class="toplevel"><a href="#alternet_tools" title="Alternet Tools">Alternet Tools</a></li>
						<li class="toplevel"><a href="#Maven_import" title="Maven import">Maven import</a></li>
						<li class="toplevel"><a href="#JavaDoc_API_documentation" title="JavaDoc API documentation">JavaDoc API documentation</a></li>
						<li class="toplevel"><a href="#Usage" title="Usage">Usage</a></li>
						<li class="toplevel"><a href="#Discovery_Service" title="Discovery Service">Discovery Service</a></li>
		<li class="divider-vertical"></li>
		<li class="dropdown">
			<a href="#" title="More&hellip;" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">&hellip; <b class="caret"></b></a>
			<ul class="dropdown-menu" role="menu">
								<li class="dropdown-submenu">
									<a href="#Overview" title="Overview">Overview</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Lookup_keys_and_variants" title="Lookup keys and variants">Lookup keys and variants</a></li>
								<li><a href="#Class_localization" title="Class localization">Class localization</a></li>
								<li><a href="#META-INF_services_and_xservices" title="META-INF services and xservices">META-INF services and xservices</a></li>
								<li><a href="#Self-registration" title="Self-registration">Self-registration</a></li>
								<li class="dropdown-submenu">
									<a href="#Injection" title="Injection">Injection</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Example__start_situation_without_injection" title="Example : start situation (without injection)">Example : start situation (without injection)</a></li>
								<li><a href="#Target_situation_with_injection" title="Target situation (with injection)">Target situation (with injection)</a></li>
								<li><a href="#Other_usage" title="Other usage">Other usage</a></li>

									</ul>
								</li>

									</ul>
								</li>
								<li class="dropdown-submenu">
									<a href="#Concurrent_and_locking_tools" title="Concurrent and locking tools">Concurrent and locking tools</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Usage" title="Usage">Usage</a></li>

									</ul>
								</li>

			</ul>
		</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1 id="alternet_tools">Alternet Tools</h1>
</div> 
<p>Alternet Tools include discovery service tools, concurrent and locking tools, and more.</p> 
<div class="section"> 
 <h2 id="Maven_import">Maven import</h2> 
 <div class="source"> 
  <pre>&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-tools&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="JavaDoc_API_documentation">JavaDoc API documentation</h2> 
 <ul> 
  <li><a href="apidocs/index.html">Alternet Tools</a></li> 
 </ul> 
 <p>Other Alternet APIs :</p> 
 <ul> 
  <li><a href="../apidocs/index.html">Alternet Libs</a></li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Usage">Usage</h2> 
 <p>Alternet Tools contains mainly :</p> 
 <ul> 
  <li>a discovery service that can be optionally used with injection (JSR330)</li> 
  <li>concurrent and locking tools</li> 
  <li>and additional utility classes</li> 
 </ul> 
 <p>This documentation covers the two former ; please consult the <a href="apidocs/index.html">Javadoc API</a> for the latter.</p> 
</div> 
<div class="section"> 
 <h2 id="Discovery_Service">Discovery Service</h2> 
 <p>The <a href="apidocs/ml/alternet/discover/DiscoveryService.html">DiscoveryService</a> class is a component for retrieving classes that support the following features :</p> 
 <ul> 
  <li>several variant implementations can be defined aside</li> 
  <li>automatic generation of the bindings</li> 
  <li>support of injection (JSR330) with :</li> 
  <li> 
   <ul> 
    <li>out-of-the-box pre-defined qualifier</li> 
   </ul></li> 
  <li> 
   <ul> 
    <li>automatic generation of producer classes</li> 
   </ul></li> 
 </ul> 
</div> 
<div class="section"> 
 <h2 id="Overview">Overview</h2> 
 <p>Consider that “<tt>Protocol</tt>” is an interface ; a specific variant of this interface can be retrieved with :</p> 
 <div class="source"> 
  <pre>    Protocol protocol = DiscoveryService.newInstance(&quot;org.acme.Protocol/http&quot;);
</pre> 
 </div> 
 <p>The more convenient way to bind an implementation is to define the file <tt>META-INF/xservices/org.acme.Protocol/http</tt> that might contain :</p> 
 <div class="source"> 
  <pre>org.acme.protocols.HttpProtocol
</pre> 
 </div> 
 <p>but other means to retrieve an implementation are also available (see below). Note that <tt>META-INF/xservices/</tt> resources can be generated automatically (see below).</p> 
 <div class="section"> 
  <h3 id="Lookup_keys_and_variants">Lookup keys and variants</h3> 
  <p>The lookup key is usually the fully qualified name of a class (usually abstract or an interface) : <tt>org.acme.Protocol</tt>, and the resolved class name should be a concrete implementation of it; the lookup key can also be a name, even a JNDI name.</p> 
  <p>Inner class names contains a $ sign in their name ; all lookup are performed on keys where the $ sign is replace by a dot. If you define manually a <tt>META-INF/xservices/</tt> entry, don’t write file names or directory names with a dollar, but with a dot instead.</p> 
  <p>The lookup key can be supplied with a variant, in order to bind several implementations (this has to be taken in charge by the caller); for example, <tt>org.acme.SerializerFactory/image/png</tt>. Basically, it means that we want a factory that can supply a serializer for <tt>image/png</tt>.</p> 
  <ul> 
   <li>An implementation can be render either as a raw <tt>Class</tt> or as a singleton instance (or both across multiple calls)</li> 
   <li>The class lookup is done <i>once</i> for every class name to discover.</li> 
   <li>Singletons are instanciated by their own method “<tt>newInstance()</tt>” if they have one, or by their default zero argument constructor. If the singleton fails to instanciate, the user would still have the possibility to get the raw class and build itself an instance.</li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="Class_localization">Class localization</h3> 
  <p>An implementation is looked up from the key supplied as follows (in order):</p> 
  <ol style="list-style-type: decimal"> 
   <li>The value of the system property with the name of the key supplied if it exists and is accessible.</li> 
   <li>The value of the JNDI property with the name of the key supplied prepend with <tt>java:comp/env/</tt> if it exists and is accessible; if the resolved object is a string, it stands for a class name, otherwise for the instance to return.</li> 
   <li>The value of the init parameter of the Web application with the name of the key supplied if it exists and is accessible (&lt;web-app&gt; &lt;context-param&gt;) During its initialization, the web application must have registered a filter <tt>ml.alternet.web.WebFilter</tt>.</li> 
   <li>The contents of the file <tt>discoveryService.properties</tt> of the current directory if it exists.</li> 
   <li>The contents of the file <tt>$USER_HOME/discovery-service.properties</tt> if it exists.</li> 
   <li>The contents of the file <tt>$JAVA_HOME/jre/lib/discovery-service.properties</tt> if it exists.</li> 
   <li>The Jar Service Provider discovery mechanism specified in the Jar File Specification, and ammended by the special use of this class (see below). A jar file can have a resource (i.e. an embedded file) such as <tt>META-INF/xservices/package.Class</tt> (or <tt>META-INF/xservices/package.Class/variant</tt> if the key contains a variant) containing the name of the concrete class to instantiate.</li> 
   <li>The fallback default implementation, which is given by the <tt>META-INF/xservices/</tt> of the user library (services found with a line of comment before or ending with a comment that contains <tt># default</tt> will be processed at the end)</li> 
  </ol> 
  <p>The first value found is returned. If one of those method fails, the next is tried.</p> 
 </div> 
 <div class="section"> 
  <h3 id="META-INF_services_and_xservices"><tt>META-INF</tt> services and xservices</h3> 
  <p>The location used by this tool is <tt>META-INF/xservices/</tt>, not <tt>META-INF/services/</tt>. Actually, the common <tt>META-INF/services/</tt> directory is ruled by different conventions than those used here (specifically due to the “variant” of the key). To avoid confusion, another directory name has been retained, actually `xservices``(that stands for “extended services”).</p> 
 </div> 
 <div class="section"> 
  <h3 id="Self-registration">Self-registration</h3> 
  <p>The <a href="apidocs/ml/alternet/discover/LookupKey.html">@LookupKey</a> annotation can be used in order to generate automatically an entry in <tt>META-INF/xservices/</tt> :</p> 
  <div class="source"> 
   <pre>@LookupKey(impClass=org.acme.protocols.HttpProtocol.class)
interface Protocol {
    // ...
}
</pre> 
  </div> 
  <p>…will generate the entry in <tt>META-INF/xservices/org.acme.Protocol</tt> that contains :</p> 
  <div class="source"> 
   <pre># default
org.acme.protocols.HttpProtocol
</pre> 
  </div> 
  <p>A variant can also be specified in the lookup key annotation. The default directive can be unset. The annotation can be placed on the target implementation.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Injection">Injection</h3> 
  <p>Two additional annotations can also be used with a CDI container (JSR330).</p> 
  <p>The discovery service can be used without a CDI container, but if you want to inject classes to lookup (specifically with a variant), the annotations supplied may help.</p> 
  <p>Even if you used a CDI container, you are not compelled to inject every classes to lookup, just the ones you want to or have to inject.</p> 
  <ul> 
   <li>As mentioned previously, <a href="apidocs/ml/alternet/discover/LookupKey.html">@LookupKey</a> generates an entry in <tt>META-INF/xservices/</tt></li> 
  </ul> 
  <p>Additionally :</p> 
  <ul> 
   <li><a href="apidocs/ml/alternet/discover/Injection.LookupKey.html">@Injection.LookupKey</a> qualifies an instance to inject</li> 
   <li><a href="apidocs/ml/alternet/discover/Injection.Producer.html">@Injection.Producer</a> generates a class producer for injections</li> 
  </ul> 
  <div class="section"> 
   <h4 id="Example__start_situation_without_injection">Example : start situation (without injection)</h4> 
   <p>For example, consider a constructor :</p> 
   <div class="source"> 
    <pre>public A(B b) {
    // ...
}
</pre> 
   </div> 
   <p>where B is an interface :</p> 
   <div class="source"> 
    <pre>public interface B {
    // ...
}
</pre> 
   </div> 
   <p>which has several implementations :</p> 
   <div class="source"> 
    <pre>@LookupKey(forClass = B.class, variant = &quot;greedy&quot;)
public class B1 implements B {
    // ...
}
</pre> 
   </div> 
   <p>and :</p> 
   <div class="source"> 
    <pre>@LookupKey(forClass = B.class, variant = &quot;lazy&quot;)
public class B2 implements B {
   // ...
}
</pre> 
   </div> 
   <p>You want to inject the right class ? See below…</p> 
  </div> 
  <div class="section"> 
   <h4 id="Target_situation_with_injection">Target situation (with injection)</h4> 
   <p>First, in the constructor (or directly in the field, up to you) one have to indicates that an instance have to be injected :</p> 
   <div class="source"> 
    <pre>@javax.inject.Inject
public A(@Injection.LookupKey(&quot;standard&quot;) B b) {
    // ...
}
</pre> 
   </div> 
   <p>Then you have to set on the interface which variant you want to produce :</p> 
   <div class="source"> 
    <pre>@Injection.Producer(variant = &quot;standard&quot;, lookupVariant=&quot;lazy&quot;)
public interface B {
    // ...
}
</pre> 
   </div> 
   <p>A producer class will be generated at compile time, that will perform the lookup with the specified variant. At runtime, the container will inject the instance supplied by the producer that matches both the expected target class and the variant, if any.</p> 
  </div> 
  <div class="section"> 
   <h4 id="Other_usage">Other usage</h4> 
   <p>It is also possible to omit the variant to inject.</p> 
   <p>It is also possible to use the same variant at the injection point :</p> 
   <div class="source"> 
    <pre>@javax.inject.Inject
public A(@Injection.LookupKey(&quot;lazy&quot;) B b) {
    // ...
}
</pre> 
   </div> 
   <p>…and accordingly to generate a relevant producer :</p> 
   <div class="source"> 
    <pre>@Injection.Producer(variant = &quot;lazy&quot;)
public interface B {
    // ...
}
</pre> 
   </div> 
   <p>Sometimes, the developer doesn’t own the type to inject neither their implementations ; it is still possible to set the annotations on some code owned by the developer, for example one of its package and specify both the implementation and the target class.</p> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Concurrent_and_locking_tools">Concurrent and locking tools</h2> 
 <p>The concurrent package allows to manage mutexes and locks, based on a string ID, safe for synchronization for a given user context.</p> 
 <p>As mentionned in section 3.10.5 of the Java Language Spec 2.0 :</p> 
 <blockquote> 
  <p>“Literal strings within different classes in different packages likewise represent references to the same String object.”</p> 
 </blockquote> 
 <p>The <a href="apidocs/ml/alternet/concurrent/MutexContext.html">MutexContext</a> class allow to create a context in order to manage safe string-based mutexes, that is to say without the inherent conditions of the String class that can lead to a dead-lock.</p> 
 <p>This class is not magic:</p> 
 <ul> 
  <li>It’s up to the user to create a context per domain to avoid ID collisions. The scope of such domain depends on the application.</li> 
  <li>It can’t avoid dead-lock due to programming (it only avoids the inherent possibility of dead-locks due to string usage)</li> 
 </ul> 
 <p>A mutex or a lock doesn’t have to be explicitly remove from its context, it will be automatically removed after all references to it are dropped.</p> 
 <div class="section"> 
  <h3 id="Usage">Usage</h3> 
  <div class="source"> 
   <pre>   MutextContext mutexContext = new MutextContext();
   // ...
   
   String id = someObject.getCanonicalID();
   Mutex mutex = mutexContext.getMutex(id);
   synchronized(mutex) {
      // ...
   }
</pre> 
  </div> 
  <p>Instead of synchronizing on a <a href="apidocs/ml/alternet/concurrent/Mutex.html">Mutex</a> it is also possible to get one of the available lock :</p> 
  <ul> 
   <li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getLock-java.lang.String-">Lock</a></li> 
   <li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getReadWriteLock-java.lang.String-">ReadWriteLock</a></li> 
   <li><a href="apidocs/ml/alternet/concurrent/MutexContext.html#getStampedLock-java.lang.String-">StampedLock</a></li> 
  </ul> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/alternet/alternet-libs" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li >
							<a href="http://semantic-mismatch.blogspot.fr/" title="Blog" class="externalLink">Blog</a>
						</li>
						<li >
							<a href="../release-notes.html" title="Release notes">Release notes</a>
						</li>
						<li class="nav-header">Download</li>
						<li >
							<a href="../download.html" title="Download">Download</a>
						</li>
						<li >
							<a href="../license.html" title="License">License</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li >
							<a href="../scanner/index.html" title="Alternet Scanner">Alternet Scanner</a>
						</li>
						<li >
							<a href="../security/index.html" title="Alternet Security">Alternet Security</a>
						</li>
						<li >
							<a href="../tools/index.html" title="Alternet Tools">Alternet Tools</a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Maven reports</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Projects</li>
						<li >
							<a href="http://reflex-x.ml/" title="RefleX" class="externalLink">RefleX</a>
						</li>
						<li >
							<a href="../../" title="Alternet Libs">Alternet Libs</a>
						</li>
						<li class="nav-header">Misc</li>
						<li >
							<a href="../demo.html" title="Demos">Demos</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">Alternet Libs</span> is a bunch of common Java libraries.</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014 <a href="http://alternet.ml">Alternet</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0. </span><span class="publishDate">Last Published: 2014-09-24. </span></p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
