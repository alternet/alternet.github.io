<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-08-31 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170831" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Alternet Security &#x2013; Passwords in Java</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
            <div class="container"><div class="nav-collapse">
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Main <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../" title="Home">Home</a></li>
            <li><a href="https://github.com/alternet/alternet.ml" title="GitHub project">GitHub project</a></li>
            <li><a href="http://semantic-mismatch.blogspot.fr/" title="Blog">Blog</a></li>
            <li><a href="../release-notes.html" title="Release notes">Release notes</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../download.html" title="Download">Download</a></li>
            <li><a href="../license.html" title="License">License</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../parsing/index.html" title="Alternet Parsing">Alternet Parsing</a></li>
            <li><a href="../scanner/index.html" title="Alternet Scanner">Alternet Scanner</a></li>
            <li><a href="../security/index.html" title="Alternet Security">Alternet Security</a></li>
            <li><a href="../tools/index.html" title="Alternet Tools">Alternet Tools</a></li>
            <li><a href="../tools-generator/index.html" title="Alternet Tools - Generator">Alternet Tools - Generator</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Maven reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="project-summary.html" title="Summary">Summary</a></li>
                  <li><a href="license.html" title="Licenses">Licenses</a></li>
                  <li><a href="team-list.html" title="Team">Team</a></li>
                  <li><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="issue-tracking.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="xref/index.html" title="Source Xref">Source Xref</a></li>
                  <li><a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
                  <li><a href="failsafe-report.html" title="Failsafe Report">Failsafe Report</a></li>
                  <li><a href="surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="cpd.html" title="CPD">CPD</a></li>
                  <li><a href="pmd.html" title="PMD">PMD</a></li>
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
              </ul>
                    <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://github.com/alternet/alternet.ml" title="GitHub project">GitHub project</a></li>
    <li><a href="../demo.html" title="Other Demos">Other Demos</a></li>
                </ul>
              </li>
            </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div id="banner">
        <div class="pull-left"><a href="./" id="bannerLeft"><h2>Alternet Security</h2>
</a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-08-31<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0<span class="divider">|</span></li>
        <li class=""><a href="../.." title="Alternet">Alternet</a><span class="divider">»</span></li>
      <li class=""><a href="../index.html" title="Alternet Libs">Alternet Libs</a><span class="divider">»</span></li>
      <li class=""><a href="index.html" title="Alternet Security">Alternet Security</a><span class="divider">»</span></li>
    <li class="active ">Passwords in Java</li>
        </ul>
      </div>
        <div id="bodyColumn" >
<div class="section">
<h2><a name="Passwords_in_Java"></a>Passwords in Java</h2>
<p>The <a class="externalLink" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/crypto/CryptoSpec.html#PBEEx">Crypto Specification</a> states that since as String is immutable (and subject to be stored in a pool by the JVM), char arrays are preferred for storing password. Additionally, when a String password is no longer used, it won&#x2019;t be necessarily reclaimed immediately by the garbage collector ; in the meantime it is impossible to unset its characters. Strings are unsafe for storing passwords.</p>
<p>Usually, a password may be used for granting an access to a resource ; before and after granting such permit, the intermediate data used as the password should not remain in memory : the idea of the <a href="apidocs/ml/alternet/security/Password.html">Password</a> class is to allow a long-term storage of the password between its creation and when it is used. The <a href="apidocs/ml/alternet/security/Password.html">Password</a> class aims to obfuscate the characters of a password, if the memory is dumped it will be difficult to guess which part of the memory was a password, and even to deobfuscate it when it has been encrypted. The idea is to limit usage of the clear password outside of the <a href="apidocs/ml/alternet/security/Password.html">Password</a> class.</p>
<p>In some cases, passwords will be built from data that are coming from a String. In this case it is recommended to not keep a strong reference to such data, but be aware that such practice create a flaw in your environment.</p>
<p>In Alternet Security, passwords are always built from characters, never from String. Additionally, Web facilities are supplied to ensure that when a Web server is receiving a password, a String is never built from the incoming data. The obfuscation method used by default in Web applications is the strongest obfuscation method in Alternet Security, which relies on cryptography.</p>
<p>You will find in Alternet Security 3 mains features :</p>

<ol style="list-style-type: decimal">
  
<li>Means to <a href="#passwords">handle secure passwords</a></li>
  
<li>A nice <a href="#auth">authentication framework</a> that relies on such passwords</li>
  
<li>Extensions for <a href="#webapps">Web applications</a> with implementations for <a href="#tomcat">Tomcat</a> and <a href="#jetty">Jetty</a> web servers</li>
</ol>
<p><a name="passwords"></a></p></div>
<div class="section">
<h2><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h2>

<ul>
  
<li><a href="apidocs/index.html">Alternet Security</a></li>
  
<li><a href="../security-auth/apidocs/index.html">Alternet Security Authentication</a></li>
  
<li><a href="../security-jetty-9.1/apidocs/index.html">Alternet Security for Jetty</a></li>
  
<li><a href="../security-tomcat-8.0/apidocs/index.html">Alternet Security for Tomcat</a></li>
</ul>
<p>All Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul>
<h1>Secure passwords handling</h1></div>
<div class="section">
<h2><a name="Maven_import"></a>Maven import</h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>
<p>Additional Maven modules are available for using Alternet Security in Tomcat or Jetty (see below).</p></div>
<div class="section">
<h2><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h2>

<ul>
  
<li><a href="apidocs/index.html">Alternet Security</a></li>
</ul>
<p>All Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul></div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>The idea is to keep low the period where a password appeared in clear in the memory, in order to make it difficult to find when a memory dump is performed.</p>
<p>A password can be created thanks to a <a href="apidocs/ml/alternet/security/PasswordManager.html">PasswordManager</a>, that exist in several flavors (weak, default, or strong with encryption). To pick one, use the <a href="apidocs/ml/alternet/security/PasswordManagerFactory.html">PasswordManagerFactory</a> or supply your own implementation (your own implementation can override the default one with the <a href="../tools/tools.html">discovery service</a>).</p>

<div class="alert alert-danger" role="alert">
Once again : DO NOT CREATE A STRING OBJECT WITH THE PASSWORD CHARACTERS.
</div>
<div class="section">
<h3><a name="Password_creation"></a>Password creation</h3>

<div class="source">
<div class="source"><pre class="prettyprint linenums">char[] pwdChars = ... // this is the password
// pick one of the available password manager
// (replace XXX with the one you prefer)
PasswordManager manager = PasswordManagerFactory.getXXXPasswordManager();
Password pwd = manager.newPassword(pwdChars);
// from this point,
// pwd is safe for staying in memory as long as necessary,
// pwdChars has been unset after the creation of the password.
</pre></div></div></div>
<div class="section">
<h3><a name="Typical_usage"></a>Typical usage</h3>

<div class="source">
<div class="source"><pre class="prettyprint linenums">try (Password.Clear clear = pwd.getClearCopy()) {
    char[] clearPwd = clear.get();
    // use clearPwd in the block
}
// at this point clearPwd has been unset
// before being eligible by the garbage collector
</pre></div></div>
<p>The user has to ensure to keep the try-with-resource block as short as possible, and to not make copies of the char array if possible.</p>
<p><a name="auth"></a></p>
<h1>Authentication framework</h1>
<p>Credentials are informations supplied by a user that are used to authenticate him on an application. Typical credentials are the user login, its password, and optionally a realm or domain, but the more often only the password is used for authentication, although some tools are computing hashes with the login name.</p>
<p>Alternet Security Authentication supply a framework for implementations that reasonably clean sensible data from the memory after the hash is computed, which can&#x2019;t be guaranteed by Java standard packages.</p></div></div>
<div class="section">
<h2><a name="Maven_import"></a>Maven import</h2>
<p>This module (or any other implementation) is required for performing credentials verification, such as in Web applications (see below).</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security-auth&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h2><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h2>

<ul>
  
<li><a href="../security-auth/apidocs/index.html">Alternet Security Authentication</a></li>
</ul>
<p>All Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul></div>
<div class="section">
<h2><a name="Project_page"></a>Project page</h2>
<p>(../security-auth/security.html)</p></div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>Alternet Security Authentication comes with out-of-the-box popular hashers and crypt formatters, including legacy algorithms such as Unix crypt. The latter should be used only if you still have old passwords to check. Consider using moderns hashers instead such as PBKDF2 or BCrypt.</p>
<p>3 main classes are supplied :</p>

<ul>
  
<li><a href="../security/apidocs/ml/alternet/security/auth/Credentials.html">Credentials</a>, which is roughly a wrapper around <tt>Password</tt></li>
  
<li><a href="../security-auth/apidocs/ml/alternet/security/auth/Hasher.html">Hasher</a> which allow to compute a crypt, and check some credentials given a crypt</li>
  
<li><a href="../security-auth/apidocs/ml/alternet/security/auth/CryptFormat.html">CryptFormat</a> which allow to turn the bytes of a hash to a string crypt, or to parse a crypt in its parts</li>
</ul>
<div class="section">
<h3><a name="Generate_a_hash"></a>Generate a hash</h3>
<p>Most common hashers are available and parameterized in :</p>

<ul>
  
<li><a href="../security-auth/apidocs/ml/alternet/security/auth/hashers/CurlyBracesCryptFormatHashers.html">CurlyBracesCryptFormatHashers</a></li>
  
<li><a href="../security-auth/apidocs/ml/alternet/security/auth/hashers/ModularCryptFormatHashers.html">ModularCryptFormatHashers</a></li>
  
<li><a href="../security-auth/apidocs/ml/alternet/security/auth/hashers/UnixHashersUnixHashers.html">UnixHashersUnixHashers</a></li>
</ul>
<p>If the default configuration doesn&#x2019;t suit your needs, you can alter any supported parameter.</p>
<p>Pick a hasher and set its parameters from a formatter family. For example, let&#x2019;s hash &#x201c;<tt>password</tt>&#x201d; with PBKDF2, set a custom number of iterations, and format it in curly braces :</p>
<p>&#x201c;<tt>password</tt>&#x201d; -&gt; &#x201c;<tt>{PBKDF2}131000$tLbWWssZ45zzfi9FiDEmxA$dQlpmhY4dGvmx4MOK/uOj/WU7Lg</tt>&#x201d;</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Password pwd = ... // see above
Credentials credentials = Credentials.fromPassword(pwd);
                       // or         .fromUserPassword(user, pwd)

// pick a hasher
Hasher hasher = CurlyBracesCryptFormatHashers.PBKDF2.get()
        .setIterations(15000) // before build, you can change the parameters
        .build();

// create a crypt
String crypt = hasher.encrypt(credentials);

// now you can store it in your database
</pre></div></div></div>
<div class="section">
<h3><a name="Check_the_credentials"></a>Check the credentials</h3>
<p>When checking some credentials, you don&#x2019;t need to alter parameters such as the number of iterations, since when supported they are encoded in the string crypt.</p>
<p>Typically you will use the same hasher for creating a crypt or checking credentials :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Password pwd = ... // see above
Credentials credentials = Credentials.fromPassword(pwd);
                       // or         .fromUserPassword(user, pwd)

String crypt = ... // some hash stored in a database

// get the hasher
Hasher hasher = CurlyBracesCryptFormatHashers.PBKDF2.get()
        .build(); // no need to change the iteration, it is encoded in the crypt

if (hasher.check(credentials, crypt)) {
    // authentication succeeds
} else {
    // authentication fails
}
</pre></div></div>
<p>Sometimes, you may have existing crypts available in various formats. For that purpose, a more suitable credentials checker (see <a href="../security-auth/apidocs/ml/alternet/security/auth/CredentialsChecker.html">CredentialsChecker</a>) will lookup for the right hasher.</p>
<p>For example, the following credentials checker will try all the formats in sequence. Note in the example the <tt>PlainTextCryptFormat</tt> is used as the last attempt to check clear passwords, and should not be used in production.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">CredentialsChecker checker = new CredentialsChecker.$(
    ModularCryptFormat, 
    CurlyBracesCryptFormat, 
    PlainTextCryptFormat
);
if (checker.check(credentials, crypt)) {
    // authentication succeeds
} else {
    // authentication fails
}
</pre></div></div>
<p><a name="webapps"></a></p>
<h1>Alternet Security for Web applications</h1>
<p>Alternet Security for Web applications allow handling safe passwords inside Web applications : during the Web processing chain, a password NEVER appear as a String (unsafe) inside the server.</p>
<p>It consist on two parts :</p>

<ul>
  
<li>Using safe password in servlet-based applications or RESTful (JAX-RS) applications (included in the first Maven module)</li>
  
<li>Enhancing an existing Web container (<a href="#jetty">Jetty</a>, <a href="#tomcat">Tomcat</a>) to make that feature available in Web applications (specifics Maven modules are supplied).</li>
</ul>
<p>The default password manager used in Web application is the strong password manager that encrypt passwords.</p>
<p>According to the Web container (<a href="#jetty">Jetty</a>, <a href="#tomcat">Tomcat</a>) in use, additional configurations are expected (see below).</p></div></div>
<div class="section">
<h2><a name="Web_applications"></a>Web applications</h2>
<p>Safe passwords can be handled in the same way whatever the concrete underlying Web container.</p>
<p>In web applications, a password can be sent to the server :</p>

<ul>
  
<li>For authentication (with HTTP Basic or Form authentications)</li>
  
<li>For other specific process, such as the registration of a new user account, or for changing a user password.</li>
</ul>
<p>Note that sending a form with a password (for login, for registration, for changing a user password or for any other purpose) have to be performed with HTTP POST ; sending a password with HTTP GET is unsecure and therefore not available with Alternet Security.</p>
<p>The Web application have to be configured (<tt>web.xml</tt> file) with values that takes the shape of a path, as shown follow :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;context-param&gt;
    &lt;param-name&gt;ml.alternet.security.web.config.formFields&lt;/param-name&gt;
    &lt;param-value&gt;
          /doRegister.html?pwd&amp;confirmPwd,
          /doUpdatePassword.html?oldPwd&amp;newPwd&amp;confirmPwd
    &lt;/param-value&gt;&lt;!-- didn't you forget to XML-escape the '&amp;' characters above ? --&gt;
&lt;/context-param&gt;
&lt;context-param&gt;
    &lt;param-name&gt;ml.alternet.security.web.config.authenticationMethod&lt;/param-name&gt;
    &lt;param-value&gt;Basic&lt;/param-value&gt;
&lt;/context-param&gt;
</pre></div></div>
<p>The former context parameter consist of a comma-separated sequence of paths relative to the context path ; those paths are the target destination to which form data are posted, and that indicates in their query string the fields of the form parameters that contains the passwords to capture.</p>
<p>The latter context parameter indicates the authentication method ; setting &#x201c;Basic&#x201d; indicates to capture passwords during HTTP Basic Authentication ; setting &#x201c;Form&#x201d; indicates to capture passwords during HTTP Form Authentication (in this case no need to mention the path and password fields if they are standard values). If this parameter is missing, no login will be handled by Alternet Security.</p>
<p>Once configured properly (see below (<a href="#jetty">Jetty</a> and <a href="#tomcat">Tomcat</a>) configurations), the Web container will substitute the passwords found in the form fields or HTTP authentication header with &#x2018;*&#x2019; characters, in order to make such strings unusable ; the actual passwords will be wrapped in <a href="apidocs/ml/alternet/security/Password.html">Password</a> instances, and will be available like shown hereafter :</p>
<div class="section">
<h3><a name="Servlets_applications"></a>Servlets applications</h3>
<p>To retrieve the passwords in a Servlet, use the <a href="apidocs/ml/alternet/security/web/Passwords.html">Passwords</a> class :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">public void doPost(HttpServletRequest req, HttpServletResponse resp) {
    // retrieve a single password of a form field
    Password pwd = Passwords.getPasswords(req, &quot;pwdField&quot;);
    // ...
}
</pre></div></div>
<p>The <a href="apidocs/ml/alternet/security/web/PasswordParam.html">PasswordParam</a> class represent a sequence of passwords, since fields (in Web forms or in HTTP headers) can be multivalued :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">public void doPost(HttpServletRequest req, HttpServletResponse resp) {
    // retrieve all passwords of a multivalued field
    PasswordParam allPwd = Passwords.getPasswords(req, &quot;pwdField&quot;);
    for (Password pwd: allPwd) {
        // ...
    }
}
</pre></div></div></div>
<div class="section">
<h3><a name="RESTfull_applications_JAX-RS"></a>RESTfull applications (JAX-RS)</h3>
<p>Simply use the <a href="apidocs/ml/alternet/security/Password.html">Password</a> class (or the <a href="apidocs/ml/alternet/security/web/PasswordParam.html">PasswordParam</a> class for handling multiple values) in the parameter of a REST method :</p>

<div class="alert alert-danger" role="alert">
Don't use <tt>List&lt;Password&gt;</tt> for handling multiple values, use
<tt>PasswordParam</tt> instead.
</div>

<div class="source">
<div class="source"><pre class="prettyprint linenums">@POST
public String getSomeData(@FormParam(&quot;username&quot;) String userName,
                          @FormParam(&quot;pwdField&quot;) Password pwd) {
    // ...
}
</pre></div></div>
<p>Note that the <a href="apidocs/ml/alternet/security/Password.html">Password</a> instance as well as the <a href="apidocs/ml/alternet/security/web/PasswordParam.html">PasswordParam</a> instance are supplied thanks to the <a href="apidocs/ml/alternet/security/web/PasswordConverterProvider.html">PasswordConverterProvider</a> annotated as a provider. According to the JAX-RS specification, this provider has to be registered to the concrete JAX-RS engine (this can be done either manually or discovered automatically ; please check the documentation of your JAX-RS engine).</p></div></div>
<div class="section">
<h2><a name="Web_containers"></a>Web containers</h2>
<p>Specific submodules supply means for the Web container to capture the received passwords.</p>
<p>To ensure security, passwords received by the server are NEVER stored in a String.</p>
<p>The passwords are captured from the raw input data stream (char or bytes) and stored in a safe password object ; the raw data are replaced by a dummy value (typically &#x2018;*&#x2019; characters) that will appear in Strings that would be handled uselessly by the application. Of course, this value can&#x2019;t be used in the application, instead, the safe password object will be injected in the Web application.</p>
<p><a name="jetty"></a></p>
<div class="section">
<h3><a name="Jetty"></a>Jetty</h3>
<p>Note that Jetty provides a feature for obfuscating passwords, but it doesn&#x2019;t serve the same purpose : only the passwords allowing to access data sources are obfuscated, and this is performed in order to store them on the file system aside the application configuration (typically, the password that allow to access a database). Jetty doesn&#x2019;t supply any mean to handle passwords from HTTP requests the way Alternet Security does.</p>

<ul>
  
<li>Require Java 8+ and Jetty 9.1+.</li>
  
<li>Jetty usually use buffers that are large enough to process passwords handling in a single chunk of data.</li>
</ul>
<p>The <a href="../security-jetty-9.1/surefire-report.html">Jetty tests</a> show how a password is captured (<a class="externalLink" href="https://github.com/alternet/alternet.ml/blob/master/security-jetty-9.1/src/test/java/ml/alternet/test/security/web/jetty/RESTTest.java">source code</a>).</p>
<div class="section">
<h4><a name="Maven_import"></a>Maven import</h4>
<p>Don&#x2019;t forget to also import the authentication module for checking the credentials (see above).</p>
<p>Jetty 9.1 and 9.2 :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security-jetty-9.1&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div>
<p>Jetty 9.3 :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security-jetty-9.3&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h4><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h4>

<ul>
  
<li><a href="../security-jetty-9.1/apidocs/index.html">Alternet Security for Jetty</a></li>
</ul>
<p>All Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul></div></div></div>
<div class="section">
<h2><a name="Project_page"></a>Project page</h2>
<p>(../security-jetty-9.1/security.html)</p>
<div class="section">
<div class="section">
<h4><a name="Jetty_programmatic_configuration"></a>Jetty programmatic configuration</h4>
<p>Configuring Jetty is very simple :</p>

<ul>
  
<li>set a parameter to the Web app context to tell which paths and form fields to intercept in the HTTP requests (like in the <tt>web.xml</tt> configuration file, see above),</li>
  
<li>create a <a href="../security-jetty-9.1/apidocs/ml/alternet/security/web/jetty/AltHttpConnectionFactory.html">AltHttpConnectionFactory</a></li>
  
<li>and bound it to the Jetty server connector.</li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    WebAppContext wac = new WebAppContext();
    // configure for handling the &quot;pwd&quot; field when POSTing on the &quot;/doRegister.html&quot; path
    wac.setInitParameter(Passwords.FORMS_INIT_PARAM, &quot;/doRegister.html?pwd&quot;);

    Server server = new Server();
    AltHttpConnectionFactory cf = new AltHttpConnectionFactory(server);

    ServerConnector connector = new ServerConnector(server, cf);
    connector.setPort(port);
    server.setConnectors(new Connector[]{connector});

    // do things normally with Jetty
    ServletHolder sh = ... // your servlet

    ServletHandler servletHandler = new ServletHandler();
    servletHandler.addServletWithMapping(sh, &quot;/*&quot;);

    wac.setServletHandler(servletHandler);
    wac.setResourceBase(resourceBase); // static resources
    wac.setContextPath(&quot;/app&quot;);

    server.setHandler(wac);

    server.start();
</pre></div></div>
<p>Various full working examples of programmatic configurations are available in the <a class="externalLink" href="https://github.com/alternet/alternet.ml/blob/master/security-jetty-9.1/src/test/java/ml/alternet/test/security/web/jetty/">project test pages</a>.</p></div>
<div class="section">
<h4><a name="Jetty_XML_configuration"></a>Jetty XML configuration</h4>
<p>Instead of configuring the Jetty server with :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    &lt;New class=&quot;org.eclipse.jetty.server.HttpConnectionFactory&quot;/&gt;
</pre></div></div>
<p>&#x2026;you have to replace it with :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    &lt;New class=&quot;ml.alternet.security.web.jetty.AltHttpConnectionFactory&quot;&gt;
        &lt;Arg&gt;&lt;Ref refid=&quot;Server&quot;/&gt;&lt;/Arg&gt;
    &lt;/New&gt;
</pre></div></div></div>
<div class="section">
<h4><a name="Native_Jetty_Authentication"></a>Native Jetty Authentication</h4>
<p>So far, the configuration above will only capture passwords. If you want let Jetty to perform authentication, you need additional configuration, according to the underlying authentication mechanism.</p>
<div class="section">
<h5><a name="LDAP_authentication"></a>LDAP authentication</h5>
<p>Here is the full XML configuration file :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;Configure id=&quot;Server&quot; class=&quot;org.eclipse.jetty.server.Server&quot;&gt;
  &lt;Call name=&quot;addBean&quot;&gt;
    &lt;Arg&gt;
       &lt;New class=&quot;org.eclipse.jetty.jaas.JAASLoginService&quot;&gt;
         &lt;Set name=&quot;name&quot;&gt;Alternet Realm&lt;/Set&gt;
         &lt;Set name=&quot;loginModuleName&quot;&gt;ldap&lt;/Set&gt;
       &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
  &lt;Call name=&quot;addConnector&quot;&gt;
    &lt;Arg&gt;
      &lt;New id=&quot;httpConnector&quot; class=&quot;org.eclipse.jetty.server.ServerConnector&quot;&gt;
        &lt;Arg name=&quot;server&quot;&gt;&lt;Ref refid=&quot;Server&quot; /&gt;&lt;/Arg&gt;
        &lt;Arg name=&quot;factories&quot;&gt;
          &lt;Array type=&quot;org.eclipse.jetty.server.ConnectionFactory&quot;&gt;
            &lt;Item&gt;
              &lt;New class=&quot;ml.alternet.security.web.jetty.AltHttpConnectionFactory&quot;&gt;
                &lt;Arg&gt;&lt;Ref refid=&quot;Server&quot;/&gt;&lt;/Arg&gt;
              &lt;/New&gt;
            &lt;/Item&gt;
          &lt;/Array&gt;
        &lt;/Arg&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
&lt;/Configure&gt;
</pre></div></div>
<p>The JAAS login module, (typically in <tt>${jetty.base}/etc/ldap.conf</tt>) will look like :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">ldap {
    ml.alternet.security.web.jetty.auth.AltLdapLoginModule required

    useSSL=&quot;false&quot;
    debug=&quot;true&quot;
    contextFactory=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot;
    hostname=&quot;localhost&quot;
    port=&quot;10389&quot;

    bindDn=&quot;ou=people,dc=alternet,dc=ml&quot;
    bindPassword=&quot;secret&quot;
    authenticationMethod=&quot;simple&quot;
    forceBindingLogin=&quot;false&quot;
    ml.alternet.security.auth.CryptFormat=&quot;ml.alternet.security.auth.formats.ModularCryptFormat, ml.alternet.security.auth.formats.CurlyBracesCryptFormat, ml.alternet.security.auth.formats.PlainTextCryptFormat&quot;

    userBaseDn=&quot;ou=people,dc=alternet,dc=ml&quot;
    userRdnAttribute=&quot;uid&quot;
    userIdAttribute=&quot;uid&quot;
    userPasswordAttribute=&quot;userPassword&quot;
    userObjectClass=&quot;inetOrgPerson&quot;

    roleBaseDn=&quot;ou=groups,dc=alternet,dc=ml&quot;
    roleNameAttribute=&quot;cn&quot;
    roleMemberAttribute=&quot;member&quot;
    roleObjectClass=&quot;groupOfNames&quot;;

};
</pre></div></div>
<p>If <tt>forceBindingLogin=&quot;true&quot;</tt>, it means that the LDAP server will perform the check of the credentials ; in that case the <tt>ml.alternet.security.auth.CryptFormat</tt> parameter may be omitted.</p>
<p>If <tt>forceBindingLogin=&quot;false&quot;</tt>, it means that Jetty will retrieve the hash from the LDAP server and perform the check of the credentials ; in that case the <tt>ml.alternet.security.auth.CryptFormat</tt> parameter will contain a comma-separated list of concrete classes. Note that <tt>ml.alternet.security.auth.formats.PlainTextCryptFormat</tt> is used for plain text passwords stored not hashed in the LDAP server and MUST NOT be used in production environments.</p>
<p><a name="tomcat"></a></p></div></div></div>
<div class="section">
<h3><a name="Jetty_full_running_example"></a>Jetty full running example</h3>
<p>You can checkout this full featured example available here <a class="externalLink" href="https://github.com/alternet/alternet.ml/tree/master/security-jetty-9.1-demo-jaas-ldap">https://github.com/alternet/alternet.ml/tree/master/security-jetty-9.1-demo-jaas-ldap</a></p>
<p>Run it with <tt>mvn verify</tt> and launch a browser to <a class="externalLink" href="http://localhost:8080">http://localhost:8080</a></p>
<p>This example runs a Jetty server and an LDAP server and connect the authentication plumbing with Alternet Security.</p></div>
<div class="section">
<h3><a name="Tomcat"></a>Tomcat</h3>

<ul>
  
<li>Require Java 8+ and Tomcat 8.0.17 and above.</li>
</ul>
<p>The <a href="../security-tomcat-8.0/surefire-report.html">Tomcat tests</a> show how a password is captured (<a class="externalLink" href="https://github.com/alternet/alternet.ml/blob/master/security-tomcat-8.0/src/test/java/ml/alternet/test/security/web/tomcat/RESTTest.java">source code</a>).</p>
<div class="section">
<h4><a name="Maven_import"></a>Maven import</h4>
<p>Don&#x2019;t forget to also import a module that checks the credentials (see above).</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;ml.alternet&lt;/groupId&gt;
    &lt;artifactId&gt;alternet-security-tomcat-8.0&lt;/artifactId&gt;
    &lt;version&gt;1.0&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h4><a name="JavaDoc_API_documentation"></a>JavaDoc API documentation</h4>

<ul>
  
<li><a href="../security-tomcat-8.0/apidocs/index.html">Alternet Security for Tomcat</a></li>
</ul>
<p>All Alternet APIs :</p>

<ul>
  
<li><a href="../apidocs/index.html">Alternet Libs</a></li>
</ul></div></div></div>
<div class="section">
<h2><a name="Project_page"></a>Project page</h2>
<p>(../security-tomcat-8.0/security.html)</p>
<div class="section">
<div class="section">
<h4><a name="Tomcat_programmatic_configuration"></a>Tomcat programmatic configuration</h4>
<p>Configuring Tomcat is very simple :</p>

<ul>
  
<li>create a specific connector <a href="../security-tomcat-8.0/apidocs/ml/alternet/security/web/tomcat/AltProtocolHandler.html">AltProtocolHandler</a></li>
  
<li>create a specific authenticator <a href="../security-tomcat-8.0/apidocs/ml/alternet/security/web/tomcat/AltBasicAuthenticator.html">AltBasicAuthenticator</a></li>
  
<li>create a specific credential handler <a href="../security-tomcat-8.0/apidocs/ml/alternet/security/web/tomcat/AltCredentialHandler.html">AltCredentialHandler</a></li>
</ul>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Tomcat server = new Tomcat();

// use the specific connector
Connector connector = new Connector(&quot;ml.alternet.security.web.tomcat.AltProtocolHandler&quot;);
connector.setPort(port);
// set in &quot;tomcatProtocol&quot; what you would have set in the Connector constructor
connector.setProperty(&quot;tomcatProtocol&quot;, &quot;HTTP/1.1&quot;);
// you can omit the following line, it is the default setting
connector.setProperty(&quot;passwordManager&quot;, &quot;ml.alternet.security.impl.StrongPasswordManager&quot;);
server.getService().addConnector(connector);
server.setConnector(connector);

// create a webapp
Context wac = server.addContext(contextPath, resourceBase);
Wrapper servlet = Tomcat.addServlet(wac, &quot;YOUR_SERVLET&quot;, new YourServlet());
wac.addServletMapping(&quot;/*&quot;, &quot;YOUR_SERVLET&quot;);

// specific security config
AuthenticatorBase auth = new AltBasicAuthenticator();
auth.setSecurePagesWithPragma(false);
auth.setChangeSessionIdOnAuthentication(false);
auth.setAlwaysUseSession(true);
((StandardContext) wac).addValve(auth);

// the following setting should be set in web.xml
ApplicationParameter initParam = new ApplicationParameter();
initParam.setName(Config.AUTH_METHOD_INIT_PARAM);
initParam.setValue(&quot;Basic&quot;);
wac.addApplicationParameter(initParam);

Realm realm = new ...();
realm.setCredentialHandler(new AltCredentialHandler());
wac.setRealm(realm);

// the remaining configuration is standard tomcat configuration
wac.setPreemptiveAuthentication(true);
wac.setPrivileged(true);
wac.addSecurityRole(&quot;customer&quot;);
wac.addSecurityRole(&quot;admin&quot;);
wac.setLoginConfig(new LoginConfig(&quot;BASIC&quot;, &quot;realm&quot;, &quot;/login.html&quot;, &quot;/error.html&quot;));
SecurityConstraint security = new SecurityConstraint();
security.addAuthRole(&quot;admin&quot;);
security.setAuthConstraint(true);
SecurityCollection coll = new SecurityCollection();
coll.addMethod(&quot;GET&quot;);
coll.addPattern(&quot;/*&quot;);
security.addCollection(coll);
wac.addConstraint(security);

server.start();
</pre></div></div>
<p>Various full working examples of programmatic configurations are available in the <a class="externalLink" href="https://github.com/alternet/alternet.ml/blob/master/security-tomcat-8.0/src/test/java/ml/alternet/test/security/web/tomcat/">project test pages</a>.</p></div>
<div class="section">
<h4><a name="Tomcat_XML_configuration"></a>Tomcat XML configuration</h4>
<p>Configuring Tomcat can be done simply in <tt>server.xml</tt> ; the Alternet libraries also have to be available to Catalina. You can either drop the required library in the <tt>lib</tt> directory of Catalina, or preferably as mentioned in the <a class="externalLink" href="http://tomcat.apache.org/tomcat-8.0-doc/RUNNING.txt">Tomcat documentation (Advanced Configuration - Multiple Tomcat Instances)</a>, in a separate Tomcat instance. Below, we consider that the Tomcat installation is left as-is, and that we are creating a separate instance.</p>
<p>The idea is to set <tt>$CATALINA_HOME</tt> and <tt>$CATALINA_BASE</tt> when launching Tomcat.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">export CATALINA_HOME=/path/to/server/apache-tomcat-8.0.18
export CATALINA_BASE=/path/to/server/myTomcat
cp -R $CATALINA_HOME/conf $CATALINA_BASE
</pre></div></div>
<p>Firstly, generate the required Alternet libraries and copy it to your Tomcat custom instance :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">cd /path/to/projects/ml.alternet/security-tomcat-8.0
mvn jar:jar shade:shade
</pre></div></div>
<p>This will produce the required library in the project folder : <tt>src/server/tomcat.8080/lib/alternet-security-tomcat-bundle.jar</tt> Copy this file in your folder <tt>$CATALINA_BASE/lib/</tt> ; you can of course copy additional libraries, for example a custom hasher (see below).</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">cp src/server/tomcat.8080/lib/alternet-security-tomcat-bundle.jar $CATALINA_BASE/lib/
</pre></div></div>
<p>Edit the file <tt>$CATALINA_BASE/conf/server.xml</tt> and change it as follow :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;
    &lt;GlobalNamingResources&gt;
        &lt;Resource auth=&quot;Container&quot; description=&quot;User database that can be updated and saved&quot;
                factory=&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;
                name=&quot;UserDatabase&quot; pathname=&quot;conf/tomcat-users.xml&quot;
                type=&quot;org.apache.catalina.UserDatabase&quot; /&gt;
    &lt;/GlobalNamingResources&gt;
    &lt;Service name=&quot;Catalina&quot;&gt;
        &lt;Connector connectionTimeout=&quot;20000&quot; port=&quot;8080&quot; redirectPort=&quot;8443&quot;
            tomcatProtocol=&quot;HTTP/1.1&quot;
            protocol=&quot;ml.alternet.security.web.tomcat.AltProtocolHandler&quot;
            passwordManager=&quot;ml.alternet.security.impl.StrongPasswordManager&quot;/&gt;
            &lt;!-- you can omit the &quot;passwordManager&quot; attribute if the default
                value shown above suits your needs --&gt;
        &lt;Engine defaultHost=&quot;localhost&quot; name=&quot;Catalina&quot;&gt;
            &lt;Realm className=&quot;org.apache.catalina.realm.UserDatabaseRealm&quot; resourceName=&quot;UserDatabase&quot;&gt;
                &lt;CredentialHandler className=&quot;ml.alternet.security.web.tomcat.AltCredentialHandler&quot;
                    hasher=&quot;ml.alternet.security.auth.impl.PBKDF2Hasher&quot;/&gt;
                    &lt;!-- you can omit the &quot;hasher&quot; attribute if the default
                         value shown above suits your needs --&gt;
                    &lt;!-- TODO : refactoring needed =&gt; use crypt formats instead --&gt;

            &lt;/Realm&gt;
            &lt;Host appBase=&quot;webapps&quot; autoDeploy=&quot;true&quot; name=&quot;localhost&quot; unpackWARs=&quot;true&quot;&gt;
                &lt;Context docBase=&quot;webapps/ROOT&quot;
                    path=&quot;&quot; reloadable=&quot;false&quot; &gt;
                    &lt;Valve className=&quot;ml.alternet.security.web.tomcat.AltBasicAuthenticator&quot;/&gt;
                    &lt;!-- you can omit the &lt;Valve&gt; element if you don't want
                         Alternet handling your BASIC HTTP Authentication, or
                         use your own --&gt;
                &lt;/Context&gt;
            &lt;/Host&gt;
        &lt;/Engine&gt;
    &lt;/Service&gt;
&lt;/Server&gt;
</pre></div></div>

<ul>
  
<li>configure the Alternet <tt>&lt;Connector&gt;</tt> : the &#x201c;passwordManager&#x201d; attributes contains the name of a class that implements <a href="apidocs/ml/alternet/security/PasswordManager.html">PasswordManager</a> ; the default value is shown in the example above</li>
  
<li>set the Alternet <tt>&lt;CredentialHandler&gt;</tt> to your <tt>&lt;Realm&gt;</tt> : the &#x201c;hasher&#x201d; attribute contains the name of a class that implements <a href="apidocs/ml/alternet/security/auth/Hasher.html">Hasher</a> ; the default value is shown in the example above</li>
  
<li>configure your <tt>&lt;Context&gt;</tt> with an Alternet <tt>&lt;Valve&gt;</tt> that use a specific authenticator (if you intend to deploy an application that use BASIC HTTP Authentication)</li>
</ul>
<p>Ensure that the passwords available in your realm are hashed values. If you use <tt>$CATALINA_BASE/conf/tomcat-users.xml</tt> it will look like this :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">&lt;tomcat-users ...&gt;
    &lt;role ...&gt;
    &lt;user username=&quot;tomcat&quot; roles=&quot;tomcat&quot;
        password=&quot;PBKDF2:1000:hOB9xOwuxpl1vE02QqVP5Cx4dWcnMghJ:ruJNwcPd7nH4ebwSG0GaIdCdUmkzrYX3&quot;/&gt;
    &lt;...&gt;
&lt;/tomcat-users&gt;
</pre></div></div>
<p>If you use another kind of resource, such as a database, store the user password hash accordingly. The Alternet credential handler will simply compare the password supply by the user with the hash stored in the resource.</p>
<hr />
<p>TODO : the following is deprecated</p>
<p>To produce such a hash, you can compute a hash with Alternet Security :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">java -cp $CATALINA_BASE/lib/alternet-security-tomcat-bundle.jar ml.alternet.security.auth.impl.PBKDF2Hasher --encrypt
</pre></div></div>
<p>you will be prompted for a password.</p>
<hr />
<p>Ideally, a user account manager application should allow to initialize user accounts transparently.</p>
<p>Once all those settings are done, you can deploy your Web application in <tt>$CATALINA_BASE/webapps/</tt></p>
<p>Don&#x2019;t forget the required settings in <tt>$CATALINA_BASE/webapps/yourApp/WEB-INF/web.xml</tt> of your Web app as mentioned before.</p>
<p>Launch tomcat :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">/path/to/server/apache-tomcat-8.0.18/bin/catalina.sh start
</pre></div></div></div>
<div class="section">
<h4><a name="Example"></a>Example</h4>
<p>A full working example of Tomcat XML configuration + Webapp is available in the <a class="externalLink" href="https://github.com/alternet/alternet.ml/blob/master/security-tomcat-8.0/src/server/tomcat.8080/">project demo page</a>.</p>
<p>It can be launched from the project directory :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">export CATALINA_BASE=/path/to/projects/ml.alternet/security-tomcat/src/server/tomcat.8080/
/path/to/server/apache-tomcat-8.0.18/bin/catalina.sh start
</pre></div></div>
<!--

### Grizzly

TODO

Maven import :

```xml
<dependency>
    <groupId>ml.alternet</groupId>
    <artifactId>alternet-security-grizzly</artifactId>
    <version>1.0</version>
</dependency>
```

-->
<h1>Background</h1></div></div></div>
<div class="section">
<h2><a name="Preserving_the_security_chain"></a>Preserving the security chain</h2>
<p>Many third-party authentication mechanisms (LDAP, relational databases, etc) are performing authentication thanks to String.</p>
<p>As mentioned before, the purpose of this library is to ensure that the Web container won&#x2019;t ever create a String object from a password when the relevant Web container is properly configured.</p>
<p>It is strongly recommended to avoid String creation from passwords for this stage, for example by passing instead a char array to the authenticator. (<a class="externalLink" href="https://docs.oracle.com/javase/tutorial/jndi/ldap/simple.html">LDAP authenticator</a> support char arrays passwords)</p></div>
<div class="section">
<h2><a name="The_Authentication_Framework"></a>The Authentication Framework</h2>
<p>It&#x2019;s worth to mention that hash algorithms are kept as close as possible to the original. Adaptations are made for using them with the Password class, to clean intermediate data when possible, and to separate the production of the formated crypt from the hashed bytes. <a href="../security-auth/apidocs/ml/alternet/security/algorithms/package-summary.html">They are available here</a>.</p>
<p><a href="../security-auth/auth-formats.html">Here are some considerations about the Authentication Framework</a> (description of popular crypt formats and design considerations)</p>
<!--

## OWASP

TODO

--></div>
        </div>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>Copyright &copy;2017
<a href="http://alternet.ml">Alternet</a>.
All rights reserved.</p>
        </div>
        <p id="poweredBy" class="pull-right">  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
  </p>
        </div>
    </footer>
    </body>
</html>
